"use strict";var LS=JSON.parse(localStorage.getItem("AllInOne"))||{};angular.element(document).ready(function(){angular.bootstrap(document,["Credito"])});var roles={Unauthorized:0,Borrower:1};"undefined"==typeof LS.roles&&(LS.roles="Unauthorized",localStorage.setItem("AllInOne",JSON.stringify(LS)));var Credito=angular.module("Credito",["ngRoute","angularLoad","restangular","ngRoute","ngResource","pascalprecht.translate","ngCookies","creditoControllers","creditoCoreServices","creditoServices","creditoCoreDirectives","creditoDirectives","creditoCoreFilters","constants","angular-loading-bar","ui.bootstrap-slider","ngFileUpload","ui.bootstrap"]);Credito.config(["$routeProvider",function(a){a.when("/admin/dashboard",{templateUrl:"templates/pages/admin/dashboard.html",controller:"DashboardController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Admin])}]}}).when("/admin/faq",{templateUrl:"templates/pages/admin/faq/index.html",controller:"FAQController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Admin])}]}}).when("/admin/faq/category/create",{templateUrl:"templates/pages/admin/faq/category/create.html",controller:"FAQCategoryCreateController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Admin])}]}}).when("/admin/faq/category/edit/:id",{templateUrl:"templates/pages/admin/faq/category/edit.html",controller:"FAQCategoryEditController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Admin])}]}}).when("/admin/faq/article/create",{templateUrl:"templates/pages/admin/faq/article/create.html",controller:"FAQArticleCreateController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Admin])}]}}).when("/admin/faq/article/edit/:id",{templateUrl:"templates/pages/admin/faq/article/edit.html",controller:"FAQArticleEditController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Admin])}]}}).when("/",{templateUrl:"templates/pages/login-page.html",controller:"LoginController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/login/investor",{templateUrl:"templates/pages/login-investor.html",controller:"LoginController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/logout",{template:"",controller:"LogoutController"}).when("/register",{templateUrl:"templates/pages/registration-page.html",controller:"RegisterController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}],currentStep:function(){return-1}}}).when("/faq",{templateUrl:"templates/pages/borrower/faq.html",controller:"BorrowerFAQController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/faq/:id",{templateUrl:"templates/pages/borrower/faq.html",controller:"BorrowerFAQController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/get-loan",{templateUrl:"templates/pages/borrower/get-loan.html",controller:"GetLoanController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 1}}}).when("/details",{templateUrl:"templates/pages/borrower/personal.html",controller:"UserDetailsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 2}}}).when("/employment-and-salary",{templateUrl:"templates/pages/borrower/employment-and-salary.html",controller:"UserDetailsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 3}}}).when("/properties-and-liabilities",{templateUrl:"templates/pages/borrower/properties-and-liabilities.html",controller:"UserDetailsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 3}}}).when("/bank-account",{templateUrl:"templates/pages/borrower/bank-account.html",controller:"BankAccountController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 4}}}).when("/upload",{templateUrl:"templates/pages/upload-steps.html",controller:"UploadController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 5}}}).when("/finish",{templateUrl:"templates/pages/finish/loan-message.html",controller:"FinishDetailsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}],currentStep:function(){return 6}}}).when("/borrower-preferences",{templateUrl:"templates/pages/borrower/preferences.html",controller:"BorrowerPreferencesController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/borrower-status",{templateUrl:"templates/pages/borrower/status.html",controller:"BorrowerStatusController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/borrower-reports-and-documents",{templateUrl:"templates/pages/borrower/reports-and-documents.html",controller:"BorrowerReportAndDocumentsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/borrower-reports-and-documents-digital-signature",{templateUrl:"templates/pages/borrower/reports-and-documents-digital-signature.html",controller:"BorrowerReportAndDocumentsDigitalSignatureController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/borrower-messages",{templateUrl:"templates/pages/borrower/messages.html",controller:"BorrowerMessagesController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/borrower-forum",{templateUrl:"templates/pages/borrower/forum.html",controller:"BorrowerForumController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/loan-proccess-status",{templateUrl:"templates/pages/borrower/loan-proccess-status.html",controller:"BorrowerLoanProccessStatusController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/loan-payments",{templateUrl:"templates/pages/borrower/loan-payments.html",controller:"LoanPaymentsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/loan-recycling",{templateUrl:"templates/pages/borrower/loan-recycling.html",controller:"BorrowerLoanRecyclingController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/amortization-board",{templateUrl:"templates/pages/borrower/amortization-board.html",controller:"AmortizationBoardController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/early-payment-finish",{templateUrl:"templates/pages/borrower/early-payment-finish.html",controller:"",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/early-payment",{templateUrl:"templates/pages/borrower/early-payment.html",controller:"EarlyPaymentController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower])}]}}).when("/calculation/:userId",{templateUrl:"templates/pages/calculation-page.html",controller:"CalculationController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/search",{templateUrl:"templates/pages/investor/search.html",controller:"SearchController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/config/collaterals",{templateUrl:"templates/pages/investor/config/collaterals.html",controller:"InvestorConfigCollateralsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/config/loan",{templateUrl:"templates/pages/investor/config/loan.html",controller:"InvestorConfigLoanController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/config/general",{templateUrl:"templates/pages/investor/config/general.html",controller:"InvestorConfigGeneralController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/change-status/:id",{templateUrl:"templates/pages/investor/change-status.html",controller:"ChangeBorrowerStatusController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/borrower-details/:borrowerId",{templateUrl:"templates/pages/investor/borrower-details.html",controller:"BorrowerDetailsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/status",{templateUrl:"templates/pages/investor/status.html",controller:"InvestorStatusController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/cash-flow",{templateUrl:"templates/pages/investor/cash-flow.html",controller:"InvestorCashFlowController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/statistics",{templateUrl:"templates/pages/investor/statistics.html",controller:"InvestorStatisticsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loan-approvals",{templateUrl:"templates/pages/investor/loan-approvals.html",controller:"LoanApprovalsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/Registration",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/WaitingForApproval",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/FillInfo",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/ApproveInfo",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/Issuing",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/EarlyPaid",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/Completed",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/loans/LateInPayment",{templateUrl:"templates/pages/investor/loans.html",controller:"InvestorLoansController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/investor/reports-and-documents",{templateUrl:"templates/pages/investor/reports-and-documents.html",controller:"InvestorReportAndDocumentsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.InstInvestor])}]}}).when("/forbidden",{templateUrl:"templates/pages/forbidden-page.html",controller:"ForbiddenController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/offline",{templateUrl:"templates/pages/offline-page.html",controller:"OfflineController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized,roles.Borrower,roles.InstInvestor])}]}}).when("/terms",{templateUrl:"templates/pages/terms-page.html",controller:"TermsController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized,roles.Borrower,roles.InstInvestor])}]}}).when("/email/check",{templateUrl:"templates/pages/email/check.html",controller:"RegisterController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/email/confirm/:userId/:token",{templateUrl:"templates/pages/email/confirm.html",controller:"EmailConfirmController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/register/sms-message-verification",{templateUrl:"templates/pages/register-sms-message-verification.html",controller:"SmsMessageVerificationController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/password/reset",{templateUrl:"templates/pages/password/reset-pass.html",controller:"PasswordController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/password/reset/confirm",{templateUrl:"templates/pages/password/pending-reset.html",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/password/reset/confirm/:userId/:token",{templateUrl:"templates/pages/password/restore.html",controller:"PasswordController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).when("/password/change",{templateUrl:"templates/pages/password/change.html",controller:"PasswordController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Borrower,roles.InstInvestor,roles.Admin])}]}}).when("/emailandpassword/confirm/:userId/:emailToken/:passwordToken",{templateUrl:"templates/pages/password/email-and-password-confirm.html",controller:"EmailAndPasswordConfirmController",resolve:{permission:["authorizationService",function(a){return a.permissionCheck([roles.Unauthorized])}]}}).otherwise({redirectTo:"/"})}]),Credito.config(["RestangularProvider","CONFIG",function(a,b){a.setBaseUrl(b.API_URL)}]),Credito.config(["$httpProvider",function(a){a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["Cache-Control"]="no-cache",a.defaults.headers.get.Pragma="no-cache",a.defaults.headers.get.Expires=0}]),Credito.config(["cfpLoadingBarProvider",function(a){a.includeBar=!1}]),Credito.config(["$translateProvider",function(a){a.useStaticFilesLoader({files:[{prefix:"assets/languages/",suffix:".json"}]}),a.preferredLanguage("he"),a.useSanitizeValueStrategy("escapeParameters")}]),Credito.run(["$rootScope","$translate","$window","$location","Restangular","CONFIG","$interval","$timeout","$route",function(a,b,c,d,e,f,g,h){a.CONFIG=f,LS=JSON.parse(localStorage.getItem("AllInOne")),LS.token&&e.setDefaultHeaders({Authorization:"Bearer "+LS.token,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0}),e.addRequestInterceptor(function(a,b,c,d){var g=LS.lastTokenRetrived;if(LS.token&&("get"==b||"post"==b)){var h=1e3*f.REFRESH_TOKEN_INTERVAL*1,i=(new Date).getTime()-g<h?!1:!0;i&&$.ajax({url:f.API_URL+"/oauth/token/refresh",method:"GET",headers:{Authorization:"Bearer "+LS.token,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0},success:function(a){LS.token=a.access_token,LS.lastTokenRetrived=(new Date).getTime(),localStorage.setItem("AllInOne",JSON.stringify(LS)),e.setDefaultHeaders({Authorization:"Bearer "+LS.token,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0})},error:function(a){console.log("e",a)}})}return a}),e.setErrorInterceptor(function(b){switch(b.status){case 401:d.path("logout");break;case 500:switch(b.data.ErrorCode){case"UserCreateFailed":a.isExists=!0,a.serverError="המשתמש קיים",$(window).scrollTo(0,{duration:300}),function(){var b=g(function(){a.isExists=!1,g.cancel(b)},4e3)}();break;case"UnknownError":a.isExists=!0,a.serverError="שגיאה בהתחברות לאתר. נא לבדוק את החיבור לשרת האינטרנט ולפנות לתמיכת האתר במידת הצורך",$(window).scrollTo(0,{duration:300});var c=new RegExp("calculation");c.test(window.location.hash)||!function(){var b=g(function(){a.isExists=!1,g.cancel(b)},4e3)}();break;case"CalculationFailed":a.isExists=!0,a.serverError="שגיאת חישוב ההלוואה ללקוח. נא תפנו לתמיכה של קרדיטו",$(window).scrollTo(0,{duration:300});break;case"CalculationFailedWithMessage":a.isExists=!0,a.serverError=b.data.ErrorMessage,$(window).scrollTo(0,{duration:300})}}}),a.online=navigator.onLine,c.addEventListener("offline",function(){a.$apply(function(){a.online=!1,c.location.href="#/offline"})},!1),c.addEventListener("online",function(){a.$apply(function(){a.online=!0,c.history.back()})},!1),a.$on("$locationChangeSuccess",function(a){$(window).scrollTo(0,{duration:f.SCROLL_TO_UP_DURATION})})}]),Credito.filter("sanitize",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]);var creditoControllers=angular.module("creditoControllers",[]);creditoControllers.controller("HeaderController",["$scope","$rootScope","$translate","$location","$route","$filter","authorizationService","CONFIG","UserDetails",function(a,b,c,d,e,f,g,h,i){a.user={name:"",status:"",message:!1,messageText:"",updateStatusAndName:function(){a.userData=JSON.parse(LS.userData),i.fname=a.userData.firstName,i.lname=a.userData.lastName,i.email=a.userData.email,i.status=a.userData.status}},a.$on("$routeChangeStart",function(){a.currentRole=LS.roles,LS.user&&(a.userDetails=JSON.parse(LS.user)),LS.investorData&&"InstInvestor"==a.currentRole&&(a.investorData=JSON.parse(LS.investorData),b.investorLogoLink=a.investorData.logoLink,b.investorSiteLink=a.investorData.siteLink),"Borrower"==a.currentRole&&(a.userData=JSON.parse(LS.user),b.investorLogoLink=a.userData.investorLogoLink)}),a.showLogoutButton=function(){return void 0!==LS.token},b.isShowMenu=function(){return void 0!==LS.token},a.role=LS.roles,localStorage.setItem("AllInOne",JSON.stringify(LS))}]),creditoControllers.controller("SideMenuController",["$scope","$location","$route","$rootScope","$filter",function(a,b,c,d,e){a.currentRole=LS.roles,a.$on("$routeChangeStart",function(){a.currentRole=LS.roles}),a.isVisible=0,a.menuData={Admin:[{title:"שאלות ותשובות",href:"#/admin/faq",submenu:[],collapsed:!0}],InstInvestor:[{title:"לווים",href:"#/investor/search",submenu:[],collapsed:!0}],Borrower:[{title:"מילוי פרטים",href:"",submenu:[{title:"ההלוואה",href:"#/get-loan"},{title:"פרטים אישיים",href:"#/details"},{title:"תעסוקה והכנסה",href:"#/employment-and-salary"},{title:"נכסים והתחייבויות",href:"#/properties-and-liabilities"},{title:"חשבון בנק",href:"#/bank-account"},{title:"העלאת מסמכים",href:"#/upload"}],collapsed:!0,visible:!a.isVisible,diabled:0},{title:"ההלוואה",href:"#/get-loan",submenu:[],collapsed:!0,visible:a.isVisible,disabled:0},{title:"פרטים אישיים",href:"#/details",submenu:[],collapsed:!0,visible:a.isVisible,disabled:0},{title:"תעסוקה והכנסה",href:"#/employment-and-salary",submenu:[],collapsed:!0,visible:a.isVisible,disabled:0},{title:"נכסים והתחייבויות",href:"#/properties-and-liabilities",submenu:[],collapsed:!0,visible:a.isVisible,disabled:0},{title:"חשבון בנק",href:"#/bank-account",submenu:[],collapsed:!0,visible:a.isVisible,disabled:0},{title:"העלאת מסמכים",href:"#/upload",submenu:[],collapsed:!0,visible:a.isVisible,disabled:0}]}}]),creditoControllers.controller("AdminMenuController",["$scope",function(a){a.currentRole=LS.roles,a.$on("$routeChangeStart",function(){a.currentRole=LS.roles}),a.menuData={Admin:[{title:"Dashboard",href:"#/admin/dashboard",submenu:[],collapsed:!0},{title:"FAQ",href:"#/admin/faq",submenu:[],collapsed:!0}]}}]),creditoControllers.controller("RegisterController",["$scope","$rootScope","$route","$timeout","$location","RegistrationService","Restangular","md5","UserDetails","vcRecaptchaService","CONFIG","DecodeToken",function(a,b,c,d,e,f,g,h,i,j,k,l){LS.firstEnterFlag=1,localStorage.setItem("AllInOne",JSON.stringify(LS)),a.response=null,a.widgetId=null,a.model={key:"6LcsGh0TAAAAAHjiVv1fVrdNn1HKq26xNvYL6a-r",lang:"iw"},a.gRecaptchaResponse={success:!1},a.loginModel={userDetails:{}},g.all("investors").getList().then(function(b){a.investors=b,a.selected=b[0].id}),LS.currentStep==b.CONFIG.APPROVE_MAIL_STATUS&&d(function(){e.path("/")},3e3),a.FAQModel=[],a.showHelpMessage=function(b){FAQService.getCategories().then(function(c){a.FAQModel=c,a.flagParent=[],a.flagChild=[],d(function(){a.parentCategoryId=$("."+b).attr("categoryId"),a.articleId=$("."+b).attr("articleId"),a.parent=$("#subCategory_"+a.parentCategoryId).attr("parentId"),$("#answers_"+a.articleId).addClass("in"),$("#subCategory_"+a.parentCategoryId).addClass("in"),"undefined"!=typeof a.parent?$("#parentCategory_"+a.parent).addClass("in"):$("#parentCategory_"+a.parentCategoryId).addClass("in"),$("#showHelpMessage").modal()},500)})},a.termsModal=function(){$("#termsModal").modal()},a.registerSubmit=function(){i.id=a.loginModel.userDetails.id,i.fname=a.loginModel.userDetails.fname,i.lname=a.loginModel.userDetails.lname,i.email=a.loginModel.userDetails.email,i.phoneNumber="05"+a.loginModel.userDetails.phoneNumber,i.investorId=a.loginModel.userDetails.investorId,i.personalId=a.loginModel.userDetails.personalId,i.pass=h.createHash(a.loginModel.userDetails.pass),i.retrypass=h.createHash(a.loginModel.userDetails.retrypass),g.all("user").post(i.getRegisterUserData()).then(function(b){LS.lastTokenRetrived=(new Date).getTime(),localStorage.setItem("AllInOne",JSON.stringify(LS)),i.id=b.id,g.setDefaultHeaders(),g.all("/oauth/token").post($.param({username:a.loginModel.userDetails.personalId,password:i.pass,grant_type:"password"}),{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(b){LS.tmpToken=b.access_token,localStorage.setItem("AllInOne",JSON.stringify(LS)),a.isPhoneConfirmed="PhoneNotConfirmed"==l.decodeJwt(LS.tmpToken).AuthorizationDenied?1:0,e.path(a.isPhoneConfirmed?"register/sms-message-verification":"/")},function(a){console.log("error",a)})},function(a){console.log("error",a)})},a.$on("reloadCaptcha",function(){j.reload(a.widgetId)}),a.setResponse=function(b){a.response=b,$.ajax({url:k.API_URL+"recaptcha?gRecaptchaResponse="+a.response,method:"POST",success:function(b){a.$apply(function(){a.gRecaptchaResponse.success=JSON.parse(b).success})},error:function(b){a.$broadcast("reloadCaptcha")}})},a.setWidgetId=function(b){a.widgetId=b},a.cbExpiration=function(){j.reload(a.widgetId),a.response=null}}]),creditoControllers.controller("LoginController",["$rootScope","$scope","$location","$http","$timeout","Restangular","md5","LoginService","DecodeToken","UserDetails",function(a,b,c,d,e,f,g,h,i,j){LS.firstEnterFlag=0,LS.finishLoanFlag=0,LS.earlyPaymentFlag=0,LS.status=null,LS.investorName=null,LS.spouseTrigger=!1,localStorage.setItem("AllInOne",JSON.stringify(LS)),b.loginSubmit=function(){j.email=b.loginModel.userDetails.email,j.pass=g.createHash(b.loginModel.userDetails.pass),f.setDefaultHeaders(),f.all("/oauth/token").post($.param(j.getLoginUserData()),{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(d){b.isPhoneConfirmed="PhoneNotConfirmed"==i.decodeJwt(d.access_token).AuthorizationDenied?!0:!1,b.isPhoneConfirmed?(LS.tmpToken=d.access_token,localStorage.setItem("AllInOne",JSON.stringify(LS)),c.path("register/sms-message-verification")):(f.setDefaultHeaders(),f.all("/oauth/token").post($.param(j.getLoginUserData()),{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(b){delete LS.tmpToken,j.token=b.access_token,LS.token=b.access_token,localStorage.setItem("AllInOne",JSON.stringify(LS)),f.setDefaultHeaders({Authorization:"Bearer "+b.access_token}),f.one("user").get().then(function(b){switch(LS.lastTokenRetrived=(new Date).getTime(),localStorage.setItem("AllInOne",JSON.stringify(LS)),j.id=b.id,j.fname=b.firstName,j.status=b.status,LS.userId=b.id,LS.user=JSON.stringify(b),LS.roles=b.roles,LS.status=b.status,LS.investorName=b.investorName,localStorage.setItem("AllInOne",JSON.stringify(LS)),"InstInvestor"==LS.roles&&f.one("investor",j.getUserId()).get().then(function(b){LS.investorData=JSON.stringify(b),a.investorLogoLink=b.logoLink,a.investorSiteLink=b.siteLink,localStorage.setItem("AllInOne",JSON.stringify(LS))}),"Borrower"==LS.roles&&(a.investorLogoLink=b.investorLogoLink),b.roles[0]){case"Borrower":localStorage.setItem("AllInOne",JSON.stringify(LS)),c.path("get-loan");break;case"InstInvestor":c.path("investor/search");break;case"Admin":c.path("admin/faq")}})},function(a){b.loginModel.errorMessage=a.data.error_description,b.login.password.$setValidity("incorrect",!1),e(function(){b.login.password.$setValidity("incorrect",!0)},3e3)}))},function(a){console.log("error",a),b.loginModel.errorMessage=a.data.error_description,b.login.password.$setValidity("incorrect",!1),e(function(){b.login.password.$setValidity("incorrect",!0)},3e3)})}}]),creditoControllers.controller("GetLoanController",["$rootScope","$scope","$location","$window","$timeout","GetLoanService","Restangular","$filter","CONFIG","currentStep",function(a,b,c,d,e,f,g,h,i,j){var k=$("#loanSetup");b.loanStatus="",b.firstEnterFlag=LS.firstEnterFlag,b.MAX_LOAN_SUM=i.MAX_LOAN_SUM,b.MIN_LOAN_SUM=i.MIN_LOAN_SUM,b.borrowerModel={status:"FillInfo"!=LS.status&&"WaitingForBorrower"!=LS.status,loanDetails:{}},g.one("loan").get({}).then(function(a){a&&(b.loanStatus=a.approvalStatus,LS.loan=a,localStorage.setItem("AllInOne",JSON.stringify(LS)))}),g.one("loan/attributes").get({}).then(function(a){_.each(a,function(a){var c=k.find("input[name="+a.name+"]");c.attr("attributeTypeID",a.attributeTypeID).attr("valueType",a.valueType);b.borrowerModel.loanDetails[a.name]={name:a.name,isChanged:!1,valueType:a.valueType,attributeTypeID:a.attributeTypeID},"option"==a.valueType&&(b.borrowerModel.loanDetails[a.name].options=[],_.each(a.optionAttributeValues,function(c,d){b.borrowerModel.loanDetails[a.name].options.push({id:parseInt(c.optionAttributeValueID),value:"LoanType"==a.name?h("translate")("BORROWER.LoanType."+c.value):h("translate")("RADIO_BTN_OPTIONS."+c.value)})})),"undefined"!=typeof a.values&&("29"==a.attributeTypeID?b.borrowerModel.loanDetails[a.name].value={id:parseInt(a.values[0].value)}:"decimal"==a.valueType?b.borrowerModel.loanDetails[a.name].value=parseInt(a.values[0].value):b.borrowerModel.loanDetails[a.name].value=a.values[0].value)}),b.loanSetupSubmit=function(){b.borrowerModel.loanDetails.LoanAmount.isChanged=!0,b.borrowerModel.loanDetails.LoanDurationInMonths.isChanged=!0,b.borrowerModel.loanDetails.LoanPurpose.isChanged=!0,b.borrowerModel.loanDetails.LoanReason.isChanged=!0,b.borrowerModel.loanDetails.LoanType.isChanged=!0,f.loanDetails=[],_.each(b.borrowerModel.loanDetails,function(a,b){if("undefined"!=typeof a.value&&a.isChanged){var c="29"==a.attributeTypeID?a.value.id:a.value;f.loanDetails.push({value:c+"",attributeTypeID:a.attributeTypeID})}}),f.getLoan()},b.loanCancel=function(){f.cancelLoan()},b.loanReset=function(){b.borrowerModel.loanDetails.LoanAmount.value="",b.borrowerModel.loanDetails.LoanDurationInMonths.value="",b.borrowerModel.loanDetails.LoanType.value="",b.borrowerModel.loanDetails.LoanPurpose.value="",b.borrowerModel.loanDetails.LoanReason.value=""}})}]),creditoControllers.controller("UserDetailsController",["$rootScope","$scope","$location","$timeout","UserDetails","SpouseDetails","Restangular","$filter","currentStep","cfpLoadingBar","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k){b.borrowerModel={status:"FillInfo"!=LS.status&&"WaitingForBorrower"!=LS.status,userDetails:{},spouseDetails:{}},b.spouseTrigger=LS.spouseTrigger,b.spouseVal,b.skipFilling=function(a){c.path(a)};var l=$("#user-details"),m=$("#spouse-details"),n=function(){return"/details"==c.$$url?"employment-and-salary":"/employment-and-salary"==c.$$url?"properties-and-liabilities":"/properties-and-liabilities"==c.$$url?"bank-account":void 0};d(function(){b.spouseVal=b.spouseTrigger},1e3),b.setSpouseTrigger=function(){b.spouseTrigger=b.spouseVal&&b.spouse_details_form.$valid,LS.spouseTrigger=b.spouseTrigger},b.yearsLimit=[];for(var o=0;o<=k.MAX_YEAR_LIMIT;o++)b.yearsLimit.push(o);e.getDetailsData().then(function(a){_.each(a,function(a){var c=l.find("input[name="+a.name+"], select[name="+a.name+"]");c.attr("attributeTypeID",a.attributeTypeID).attr("valueType",a.valueType);b.borrowerModel.userDetails[a.name]={name:a.name,isChanged:!1,valueType:a.valueType,attributeTypeID:a.attributeTypeID},"option"==a.valueType&&(b.borrowerModel.userDetails[a.name].options=[],_.each(a.optionAttributeValues,function(c,d){b.borrowerModel.userDetails[a.name].options.push({id:parseInt(c.optionAttributeValueID),value:h("translate")("SELECT_OPTIONS."+c.value)})})),"undefined"!=typeof a.values?"option"==a.valueType?b.borrowerModel.userDetails[a.name].value={id:parseInt(a.values[0].value)}:"int"==a.valueType?b.borrowerModel.userDetails[a.name].value=parseFloat(a.values[0].value):"decimal"==a.valueType?b.borrowerModel.userDetails[a.name].value=parseInt(a.values[0].value):b.borrowerModel.userDetails[a.name].value=a.values[0].value:("int"==a.valueType||"decimal"==a.valueType)&&(b.borrowerModel.userDetails[a.name].value=0),"FamilyIncome"==a.name&&0==b.borrowerModel.userDetails[a.name].value&&(b.borrowerModel.userDetails[a.name].value=1)}),f.getDetailsData().then(function(a){_.each(a,function(a){var c=m.find("input[name="+a.name+"], select[name="+a.name+"]");c.attr("attributeTypeID",a.attributeTypeID).attr("valueType",a.valueType);b.borrowerModel.spouseDetails[a.name]={name:a.name,isChanged:!1,valueType:a.valueType,attributeTypeID:a.attributeTypeID},"option"==a.valueType&&(b.borrowerModel.spouseDetails[a.name].options=[],_.each(a.optionAttributeValues,function(c,d){b.borrowerModel.spouseDetails[a.name].options.push({id:parseInt(c.optionAttributeValueID),value:h("translate")("SELECT_OPTIONS."+c.value)})})),"undefined"!=typeof a.values&&("option"==a.valueType?b.borrowerModel.spouseDetails[a.name].value={id:parseInt(a.values[0].value)}:"int"==a.valueType?b.borrowerModel.spouseDetails[a.name].value=parseFloat(a.values[0].value):"decimal"==a.valueType?b.borrowerModel.spouseDetails[a.name].value=parseInt(a.values[0].value):b.borrowerModel.spouseDetails[a.name].value=a.values[0].value)}),$(".datepicker").pickadate({format:"dd-mm-yyyy",selectMonths:!0,selectYears:100,min:new Date(1900,3,20),max:new Date(1997,7,14)}),b.userDetailsSave=function(){var a=function(){f.detailsData=[],_.each(b.borrowerModel.spouseDetails,function(a,b){if(a.isChanged){var c="option"==a.valueType?a.value.id:a.value;f.detailsData.push({name:a.name,value:c,attributeTypeID:a.attributeTypeID,valueType:a.valueType})}}),f.detailsData.length>0&&f.sendDetailsData().then(function(){c.path(n())},function(a){
b.spouseTrigger=!1})};e.detailsData=[],_.each(b.borrowerModel.userDetails,function(a,b){if(a.isChanged){var c="option"==a.valueType?a.value.id:a.value;e.detailsData.push({name:a.name,value:c,attributeTypeID:a.attributeTypeID,valueType:a.valueType})}}),e.detailsData.length>0?e.sendDetailsData().then(function(){b.setSpouseTrigger(),b.spouseTrigger?a():c.path(n())},function(a){d(function(){j.complete()},1e3)}):(b.setSpouseTrigger(),b.spouseTrigger?a():c.path(n()))}})})}]),creditoControllers.controller("BankAccountController",["$scope","BankService","$location","$filter","currentStep","Restangular","CONFIG",function(a,b,c,d,e,f,g){a.borrowerModel={status:"FillInfo"!=LS.status&&"WaitingForBorrower"!=LS.status,bankAccount:{BankBranchName:null,BankAccountNumber:null,BankNameList:[],CreditCardOwnership:[],YearsInAccount:null}},a.bankAccountContainer=$("#bankAccount"),a.yearsLimit=[];for(var h=0;h<=g.MAX_YEAR_LIMIT;h++)a.yearsLimit.push(h);f.one("account").one("attributes").get().then(function(b){_.each(b,function(b){var c=a.bankAccountContainer.find("input[name="+b.name+"]");c.attr("attributeTypeID",b.attributeTypeID).attr("valueType",b.valueType),a.borrowerModel.bankAccount[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType&&(a.borrowerModel.bankAccount[b.name].options=[],_.each(b.optionAttributeValues,function(c,e){a.borrowerModel.bankAccount[b.name].options.push({id:parseInt(c.optionAttributeValueID),value:d("translate")("SELECT_OPTIONS."+c.value)})})),"undefined"!=typeof b.values&&("option"==b.valueType?a.borrowerModel.bankAccount[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.borrowerModel.bankAccount[b.name].value=parseFloat(b.values[0].value):"decimal"==b.valueType?a.borrowerModel.bankAccount[b.name].value=parseInt(b.values[0].value):a.borrowerModel.bankAccount[b.name].value=b.values[0].value)})}),a.onSubmit=function(){a.borrowerModel.bankAccount.BankBranchName.isChanged=!0,a.borrowerModel.bankAccount.BankAccountNumber.isChanged=!0,a.borrowerModel.bankAccount.BankNameList.isChanged=!0,a.borrowerModel.bankAccount.CreditCardOwnership.isChanged=!0,a.borrowerModel.bankAccount.YearsInAccount.isChanged=!0,b.bankAccount=[],_.each(a.borrowerModel.bankAccount,function(a){if(a.isChanged){var c="option"==a.valueType?a.value.id:a.value;b.bankAccount.push({value:c,attributeTypeID:a.attributeTypeID})}}),b.submitAccount().then(function(){c.path("upload")})}}]),creditoControllers.controller("UploadController",["UploadService","$rootScope","$scope","$timeout","$location","UserDetails","Restangular","$filter","currentStep",function(a,b,c,d,e,f,g,h,i){c.uploadForm=[],c.approveWindowShow=!1,c.role=LS.roles,c.spouseTrigger=LS.spouseTrigger,c.status="FillInfo"!=LS.status&&"WaitingForBorrower"!=LS.status,c.goToGetLoanPage=function(){window.location.href="#/get-loan",location.reload()},c.completeData=function(){g.one("user/attributes/completed").post().then(function(){e.path("finish")})},g.one("user/attributes").get({}).then(function(a){c.OtherInfo=_.find(a,"name","OtherInfo")}),c.commentsSaved=!1,c.saveComments=function(){g.all("user/attributes").post([{value:c.OtherInfo.values[0].value,attributeTypeID:c.OtherInfo.attributeTypeID}]).then(function(a){c.commentsSaved=!0,d(function(){c.commentsSaved=!1},2e3)},function(a){})},c.uploadFile=function(d,e,g,h,i,j){c.nameid=LS.nameid,a.uploadFile(e,b.CONFIG.API_URL+"user/attributes/upload?attributeTypeId="+g,f.getUserToken(),g,h,i,j,function(a){},function(a){console.log(a,"error")}).then(function(a){_.find(c.uploadForm,"attrId",a[0].attributeTypeID).values.push(a[0].values[0]);var b=$(".uploaded-file-position .filename");b[0]&&$(b[0]).parent().parent().remove()})},c.confirmRemoveFile=function(a,b,d){$("#confirm-delete").modal(),c.fileToDelete=a,c.fileToDelete.parentIndex=b,c.fileToDelete.index=d},c.removeFile=function(b,e,f,g,h){c.removed=[],a.removeFile(c.fileToDelete.attributeValueId).then(function(){c.uploadForm[c.fileToDelete.parentIndex].values.splice(c.fileToDelete.index,1),c.removed[c.fileToDelete.parentIndex]=!0,d(function(){c.removed[c.fileToDelete.parentIndex]=!1},2e3)})},c.downloadFile=function(b,d){c.fileName=d,a.downloadFile(b).then(function(a){c.fileType=a.type,c.reader=new Blob([a],{type:a.type}),saveAs(c.reader,decodeURIComponent(c.fileName))})},c.complete=function(){$("#finishModal").modal()},c.backToDetails=function(){e.path("details")},g.one("user/attributes").get({valueType:"blob"}).then(function(a){c.uploadForm=[{name:"UPLOAD.BankPrints"},{name:"UPLOAD.Salary"},{name:"UPLOAD.SpouseSalary"},{name:"UPLOAD.IDDocument"},{name:"UPLOAD.BankID"},{name:"UPLOAD.OtherDocument",comment:"UPLOAD.OtherDocumentComment"}];for(var b=0;b<a.length;b++)for(var d=0;d<c.uploadForm.length;d++)if("UPLOAD."+a[b].name==c.uploadForm[d].name&&(c.uploadForm[d].attrId=a[b].attributeTypeID,c.uploadForm[d].values=[],"undefined"!=typeof a[b].values))for(var e=0;e<a[b].values.length;e++)c.uploadForm[d].values.push(a[b].values[e]);setTimeout(function(){_.each(a,function(a){if("undefined"!=typeof a.values){var b=_.filter(c.uploadForm,function(b){return b.attrId==a.attributeTypeID});_.each(b,function(b,c){void 0!==a.values[c]&&(b.filename=a.values[c].value)})}})},500)}),c.counter=0,c.addFile=function(a,b,d){var e=$(".uploaded-file-position .filename:empty");e[0]&&$(e[0]).parent().parent().remove();var f=$(d.target),g='<div class="uploaded-file-position"><span><span class="glyphicon"></span><span class="progress-new-file'+c.counter+' filename upload-label"></span></span><span style="display: none" class="btn btn-primary btn-file ng-binding">עדכן<input type="file" class="select-file" file-model="fileUpload" id="progress-new-file'+c.counter+'" data="progress-new-file'+c.counter+'" attributetypeid="'+a+'" valuetype="blob" isrequired="true" name=""></span><div class="progress-container"><progress value="0" max="100" style="display: none" class=" upload-label progress-new-file'+c.counter+'"></progress></div></div>';f.before(g),document.getElementById("progress-new-file"+c.counter).click(),$("#progress-new-file"+c.counter).bind("change",function(a){var b=$("input[type=file]");b[0].files[0]&&(c.uploadFile(c.uploadForm,b[0].files[0],b.attr("attributetypeid"),b.attr("data"),f.parent().parent().find(".progress-container"),!0),$("span."+b.attr("data")).text(b[0].files[0].name),b.parent().text(h("translate")("UPLOAD.EDIT")),c.counter++)});var i=$("input[type=file]");i[0].files[0]&&(c.uploadFile(c.uploadForm,i[0].files[0],i.attr("attributetypeid"),i.attr("data"),f.parent().parent().find(".progress-container"),!0),$("span."+i.attr("data")).text(i[0].files[0].name),i.parent().text(h("translate")("UPLOAD.EDIT")),c.counter++)}}]),creditoControllers.controller("FinishDetailsController",["$location","$rootScope","$scope","$route",function(a,b,c,d){c.II_NAME=LS.investorName,LS={},localStorage.removeItem("AllInOne"),localStorage.setItem("AllInOne",JSON.stringify(LS)),LS.spouseTrigger=!1,b.investorSiteLink=null,LS.roles="Unauthorized",localStorage.setItem("AllInOne",JSON.stringify(LS))}]),creditoControllers.controller("UploadSpouseController",["UploadService","$rootScope","$scope","$timeout","$location","UserDetails","Restangular","$filter",function(a,b,c,d,e,f,g,h){c.uploadFormSpouse=[],c.role=LS.roles,setTimeout(function(){$("input[type=file]").on("change",function(a){var b=$(a.target);if(b[0].files[0]){var d=$(b).parent().parent();c.uploadFileSpouse(c.uploadFormSpouse,b[0].files[0],b.attr("attributetypeid"),b.attr("data"),d.find(".progress-container"),!1),d.find("span.filename").text(b[0].files[0].name)}})},2e3),c.uploadFileSpouse=function(d,e,g,h,i,j){c.nameid=LS.nameid,a.uploadFile(e,b.CONFIG.API_URL+"spouse/attributes/upload?attributeTypeId="+g,f.getUserToken(),g,h,i,j,function(a){},function(a){console.log(a,"error")})},g.one("spouse/attributes").get({valueType:"blob"}).then(function(a){c.uploadFormSpouse=[{name:"UPLOAD.IDDocument"},{name:"UPLOAD.OtherDocument"},{name:"UPLOAD.Salary"}];for(var b=0;b<a.length;b++)for(var d=0;d<c.uploadFormSpouse.length;d++)if("UPLOAD."+a[b].name==c.uploadFormSpouse[d].name&&(c.uploadFormSpouse[d].attrId=a[b].attributeTypeID,c.uploadFormSpouse[d].values=[],"undefined"!=typeof a[b].values))for(var e=0;e<a[b].values.length;e++)c.uploadFormSpouse[d].values.push(a[b].values[e]);setTimeout(function(){_.each(a,function(a){if("undefined"!=typeof a.values){var b=_.filter(c.uploadFormSpouse,function(b){return b.attrId==a.attributeTypeID});_.each(b,function(b,c){void 0!==a.values[c]&&(b.filename=a.values[c].value)})}})},500)}),c.counter=0,c.addFileSpouse=function(a,b,d){var e=$(d.target),f='<div class="uploaded-file-position"><span><span class="glyphicon"></span><span class="progress-new-file'+c.counter+' filename upload-label"></span></span><span style="display: none" class="btn btn-primary btn-file ng-binding">עדכן<input type="file" class="select-file" file-model="fileUpload" id="progress-new-file'+c.counter+'" data="progress-new-file'+c.counter+'" attributetypeid="'+a+'" valuetype="blob" isrequired="true" name=""></span><div class="progress-container"><progress value="0" max="100" style="display: none" class=" upload-label progress-new-file'+c.counter+'"></progress></div></div>';e.before(f),document.getElementById("progress-new-file"+c.counter).click(),$("#progress-new-file"+c.counter).bind("change",function(a){var b=$("input[type=file]");b[0].files[0]&&(c.uploadFileSpouse(c.uploadForm,b[0].files[0],b.attr("attributetypeid"),b.attr("data"),e.parent().parent().find(".progress-container"),!0),$("span."+b.attr("data")).text(b[0].files[0].name),b.parent().text(h("translate")("UPLOAD.EDIT")),c.counter++)});var g=$("input[type=file]");g[0].files[0]&&(c.uploadFileSpouse(c.uploadForm,g[0].files[0],g.attr("attributetypeid"),g.attr("data"),e.parent().parent().find(".progress-container"),!0),$("span."+g.attr("data")).text(g[0].files[0].name),g.parent().text(h("translate")("UPLOAD.EDIT")))}}]),creditoControllers.controller("BorrowerStatusController",[function(){console.log("BorrowerStatusController")}]),creditoControllers.controller("BorrowerMessagesController",[function(){console.log("BorrowerMessagesController")}]),creditoControllers.controller("BorrowerForumController",[function(){console.log("BorrowerForumController")}]),creditoControllers.controller("BorrowerReportAndDocumentsController",["$scope","BorrowerReportsAndDocumentsService",function(a,b){a.drawFile=function(c){b.getDocuments(c).then(function(b){"undefined"!=typeof Blob&&(a.reader=new Blob([b],{type:"application/pdf"}),a.urlCreator=window.URL,a.fileURL=a.urlCreator.createObjectURL(a.reader),a.fileName=c,document.getElementById("pdfRow").src=a.fileURL,"undefined"!=typeof window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(a.reader)),$("#pdfRow").show()})},a.saveFile=function(){saveAs(a.reader,decodeURIComponent(a.fileName))}}]),creditoControllers.controller("BorrowerReportAndDocumentsDigitalSignatureController",["$scope","$rootScope","$timeout","$location","Restangular","$filter","UploadService","UserDetails","BorrowerReportsAndDocumentsService",function(a,b,c,d,e,f,g,h,i){c(function(){a.drawFileWithSignature("AgreementSignatureDocument"),a.documentType="AgreementSignature"},500),a.uploadFileTrigger=!1,a.signatureTrigger=!1,a.signatureLoadAgreement=!1,a.signatureLoadPromissoryNote=!1,a.documentType="",a.currentUpload=null,a.currentSignature=null,a.borrowerModel={userDetails:{AgreementSignature:null,PromissoryNoteSignature:null}},a.loanApprovalStatus=LS.loan.approvalStatus,a.documentsAndReportsContainer=$("#documentsAndReports"),a.signatureLoadCheck=function(){a.signatureLoadAgreement=a.borrowerModel.userDetails.AgreementSignature.value?!0:!1,a.signatureLoadPromissoryNote=a.borrowerModel.userDetails.PromissoryNoteSignature.value?!0:!1,a.documentType.length>0&&"undefined"!=typeof a.borrowerModel.userDetails[a.documentType].value&&a.borrowerModel.userDetails[a.documentType].value&&(a.signatureTrigger=!1)},a.getUserDetails=function(){h.getDetailsData().then(function(b){a.AgreementSignatureDocumentFlag="undefined"!=typeof _.find(b,"name","AgreementSignature").values?1:0,a.PromissoryNoteSignatureDocumentFlag="undefined"!=typeof _.find(b,"name","PromissoryNoteSignature").values?1:0,_.each(b,function(b){var c=a.documentsAndReportsContainer.find("input[name="+b.name+"]");c.attr("attributeTypeID",b.attributeTypeID).attr("valueType",b.valueType),a.borrowerModel.userDetails[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID,value:null},"undefined"!=typeof b.values&&(a.borrowerModel.userDetails[b.name].value=b.values[0].value)}),a.signatureLoadCheck()})},a.getUserDetails(),a.uploadForm=[],a.role=LS.roles,a.uploadFile=function(c,d,e,f,i,j){a.nameid=LS.nameid,g.uploadFile(d,b.CONFIG.API_URL+"user/attributes/upload?attributeTypeId="+e,h.getUserToken(),e,f,i,j,function(a){},function(a){console.log(a,"error")}).then(function(b){a.drawUploadedFile(b[0].values[0].attributeValueId,b[0].values[0].value),_.find(a.uploadForm,"attrId",b[0].attributeTypeID).values.push(b[0].values[0]);var c=$(".uploaded-file-position .filename");c[0]&&$(c[0]).parent().parent().remove(),a.uploadComplete()})},a.confirmRemoveFile=function(b,c,d){$("#confirm-delete").modal(),a.fileToDelete=b,a.fileToDelete.parentIndex=c,a.fileToDelete.index=d},a.removeFile=function(b,d,e,f,h){a.removed=[],g.removeFile(a.fileToDelete.attributeValueId).then(function(){a.uploadForm[a.fileToDelete.parentIndex].values.splice(a.fileToDelete.index,1),a.removed[a.fileToDelete.parentIndex]=!0,c(function(){a.removed[a.fileToDelete.parentIndex]=!1},2e3),$("#pdfRow").hide(),$("#imgRow").hide()})},a.downloadFile=function(b,c){a.fileName=c,g.downloadFile(b).then(function(b){a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(a.fileName))})},a.downloadExistedFile=function(b){a.fileName=b,i.downloadFile(b).then(function(b){a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(a.fileName))})},e.one("user/attributes").get({valueType:"blob"}).then(function(b){a.uploadForm=[{name:"UPLOAD.CancelledCheque",alias:"CancelledCheque"},{name:"UPLOAD.BankPermission",alias:"BankPermission"}];for(var c=0;c<b.length;c++)for(var d=0;d<a.uploadForm.length;d++)if("UPLOAD."+b[c].name==a.uploadForm[d].name&&(a.uploadForm[d].attrId=b[c].attributeTypeID,a.uploadForm[d].values=[],"undefined"!=typeof b[c].values))for(var e=0;e<b[c].values.length;e++)a.uploadForm[d].values.push(b[c].values[e]);setTimeout(function(){_.each(b,function(b){if("undefined"!=typeof b.values){var c=_.filter(a.uploadForm,function(a){return a.attrId==b.attributeTypeID});_.each(c,function(a,c){void 0!==b.values[c]&&(a.filename=b.values[c].value)})}})},500)}),a.counter=0,a.addFile=function(b,c,d){if(!(a.uploadForm[c].values.length>0)){var e=$(".uploaded-file-position .filename:empty");e[0]&&$(e[0]).parent().parent().remove();var g=$(d.target),h='<div class="uploaded-file-position"><span><span class="glyphicon"></span><span class="progress-new-file'+a.counter+' filename upload-label"></span></span><span style="display: none" class="btn btn-primary btn-file ng-binding">עדכן<input type="file" class="select-file" file-model="fileUpload" id="progress-new-file'+a.counter+'" data="progress-new-file'+a.counter+'" attributetypeid="'+b+'" valuetype="blob" isrequired="true" name=""></span><div class="progress-container"><progress value="0" max="100" style="display: none" class=" upload-label progress-new-file'+a.counter+'"></progress></div></div>';g.before(h),document.getElementById("progress-new-file"+a.counter).click(),$("#progress-new-file"+a.counter).bind("change",function(b){var c=$("input[type=file]");c[0].files[0]&&(a.uploadFile(a.uploadForm,c[0].files[0],c.attr("attributetypeid"),c.attr("data"),g.parent().parent().find(".progress-container"),!0),$("span."+c.attr("data")).text(c[0].files[0].name),c.parent().text(f("translate")("UPLOAD.EDIT")),a.counter++)});var i=$("input[type=file]");i[0].files[0]&&(a.uploadFile(a.uploadForm,i[0].files[0],i.attr("attributetypeid"),i.attr("data"),g.parent().parent().find(".progress-container"),!0),$("span."+i.attr("data")).text(i[0].files[0].name),i.parent().text(f("translate")("UPLOAD.EDIT")),a.counter++)}},a.drawFile=function(){i.getDocumentsSignature(fileName).then(function(b){a.uploadFileTrigger=!1,a.signatureTrigger=!0,a.currentUpload=null,a.currentSignature=fileName.split(".")[0]+"Signature","undefined"!=typeof Blob&&(a.reader=new Blob([b],{type:"application/pdf"}),a.urlCreator=window.URL,a.fileURL=a.urlCreator.createObjectURL(a.reader),a.fileName=fileName,document.getElementById("pdfRow").src=a.fileURL,"undefined"!=typeof window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(a.reader)),$("#pdfRow").show(),$("#imgRow").hide(),$("#signature").show(),a.$broadcast("loadFile")})},a.drawFileWithSignature=function(b){$("#pdfRow").hide(),$("#imgRow").hide(),$("#signature").hide(),$("#SignatureText").hide(),a.fileURL=null,i.getDocumentsDigitalSignature(b).then(function(c){a.uploadFileTrigger=!1,a.signatureTrigger=!0,a.currentUpload=null,a.currentSignature=b.split(".")[0]+"Signature","undefined"!=typeof Blob&&(a.reader=new Blob([c],{type:"application/pdf"}),a.urlCreator=window.URL,a.fileURL=a.urlCreator.createObjectURL(a.reader),a.fileName=b,document.getElementById("pdfRow").src=a.fileURL,"undefined"!=typeof window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(a.reader)),$("#pdfRow").show(),$("#imgRow").hide(),$("#signature").show(),$("#SignatureText").show(),a.getUserDetails(),a.$broadcast("loadFile")})},a.drawUploadedFile=function(b,c){$("#pdfRow").hide(),$("#imgRow").hide(),$("#signature").hide(),$("#SignatureText").hide(),a.fileURL=null,i.getUploadedDocuments(b).then(function(b){if("undefined"!=typeof Blob){switch(a.urlCreator=window.URL||window.webkitURL,a.fileName=c,b.type){case"image/png":case"image/jpg":case"image/jpeg":case"image/gif":a.reader=new Blob([b],{type:b.type}),a.fileURL=a.urlCreator.createObjectURL(a.reader),$("#pdfRow").hide(),$("#imgRow").attr({src:a.fileURL}).show();break;case"application/pdf":case"application/x-download":case"application/x-pdf":a.reader=new Blob([b],{type:"application/pdf"}),a.fileURL=a.urlCreator.createObjectURL(a.reader),$("#imgRow").removeAttr("src").hide(),$("#pdfRow").attr({src:a.fileURL}).show();break;default:a.fileType=b.type,a.reader=new Blob([b],{type:b.type})}"undefined"!=typeof window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(a.reader)}a.$broadcast("loadFile")})},a.addChequeCancell=function(){a.uploadFileTrigger=!0,a.signatureTrigger=!1,a.currentUpload="CancelledCheque",a.currentSignature=null,$("#pdfRow").hide(),$("#imgRow").hide(),$("#signature").hide(),$("#documentsAndReports").find(".preview .text").text("תצוגה מקדימה של המסמך")},a.addBankPermission=function(){a.uploadFileTrigger=!0,a.signatureTrigger=!1,a.currentUpload="BankPermission",a.currentSignature=null,$("#pdfRow").hide(),$("#imgRow").hide(),$("#signature").hide(),$("#documentsAndReports").find(".preview .text").text("תצוגה מקדימה של המסמך")},a.saveSignature=function(b){$("#pdfRow").hide(),$("#imgRow").hide(),$("#signature").hide(),$("#SignatureText").hide(),a.fileURL=null,e.all("user/attributes").post([{value:b,attributeTypeID:a.borrowerModel.userDetails[a.documentType].attributeTypeID}]).then(function(b){a.drawFileWithSignature(a.documentType+"Document"),"AgreementSignature"==a.documentType&&(a.AgreementSignatureDocumentFlag=!0),"PromissoryNoteSignature"==a.documentType&&(a.PromissoryNoteSignatureDocumentFlag=!0),a.signatureTrigger=!1},function(a){})},a.uploadComplete=function(){a.signatureLoadAgreement&&a.signatureLoadPromissoryNote&&a.uploadForm[0].values.length>0&&a.uploadForm[1].values.length>0&&$("#confirm-upload").modal()},a.saveFile=function(){saveAs(a.reader,decodeURIComponent(a.fileName))}}]),creditoControllers.controller("OfflineController",["$scope","$rootScope","$window","$interval",function(a,b,c,d){var e=d(function(){navigator.onLine&&c.history.back()},2e3);d.cancel(e)}]),creditoControllers.controller("PasswordController",["$scope","$route","$window","$timeout","Restangular","md5","$location","DecodeToken",function(a,b,c,d,e,f,g,h){LS.userId&&(a.userId=LS.userId),a.reset={id:"",password:"",retrypass:""},a.showSuccessMessage=!1,a.changePassword=function(){e.all("user/"+a.userId+"/password").customPUT({oldPassword:f.createHash(a.oldPassword),newPassword:f.createHash(a.password),confirmPassword:f.createHash(a.retrypass)}).then(function(b){a.showSuccessMessage=!0,d(function(){a.showSuccessMessage=!1,g.path("logout")},2e3)},function(b){a.change.oldPassword.$setValidity("incorrect",!1),d(function(){a.change.oldPassword.$setValidity("incorrect",!0),a.oldPassword=""},3e3)})},a.resetPassword=function(){""!=a.reset.id&&e.one("password").remove({userName:a.reset.id}).then(function(){c.location.href="#/password/reset/confirm"},function(b){a.restore.IsraelId.$setValidity("idVerification",!1),d(function(){a.restore.IsraelId.$setValidity("idVerification",!0)},1e3)})},a.confrimReset=function(){a.showSuccessMessage=!1,e.all("user/"+b.current.params.userId+"/password/confirmation").post({},{token:b.current.params.token,newPassword:f.createHash(a.reset.password)}).then(function(){a.showSuccessMessage=!0,d(function(){a.showSuccessMessage=!1,g.path("/")},1e3)})}}]),creditoControllers.controller("LogoutController",["$location","$rootScope","$route",function(a,b,c){LS={},localStorage.removeItem("AllInOne"),localStorage.setItem("AllInOne",JSON.stringify(LS)),LS.spouseTrigger=!1,LS.finishLoanFlag=0,LS.earlyPaymentFlag=0,b.investorLogoLink=null,b.investorSiteLink=null,LS.roles="Unauthorized",localStorage.setItem("AllInOne",JSON.stringify(LS)),a.path("/")}]),creditoControllers.controller("EmailConfirmController",["$scope","$route","$window","$timeout","Restangular","$location",function(a,b,c,d,e,f){e.one("user",b.current.params.userId).all("email").all("confirmation").post({},{token:b.current.params.token}).then(function(a){d(function(){f.path("login")},3e3)},function(a){d(function(){f.path("login")},3e3)})}]),creditoControllers.controller("SmsMessageVerificationController",["$scope","$route","$window","$timeout","Restangular","$location","SmsMessageVerificationService","$filter","CONFIG",function(a,b,c,d,e,f,g,h,i){a.smsCode=null,a.phone=null,a.isExists=0,a.alert=0,a.alertText=null,g.getSmsCode(),a.confirmSms=function(){g.confirmation(a.smsCode).then(function(){a.alert=1,a.alertText=h("translate")("SMS.SUCCESS"),$(window).scrollTo(0,{duration:300}),d(function(){delete LS.tmpToken,localStorage.setItem("AllInOne",JSON.stringify(LS)),a.alert=0,a.alertText=null,f.path("login")},2e3)},function(b){a.serverError=h("translate")("ERRORS.SMS."+b.data.ErrorCode),a.isExists=1,$(window).scrollTo(0,{duration:i.SCROLL_TO_UP_DURATION}),d(function(){a.isExists=0,a.serverError=null,a.smsCode=null},2e3)})},a.resendSms=function(){a.smsCode=null,g.getSmsCode().then(function(){a.alert=1,a.alertText=h("translate")("SMS.CODE_RESENT"),$(window).scrollTo(0,{duration:i.SCROLL_TO_UP_DURATION}),d(function(){a.alert=0,a.alertText=null,a.smsCode=null},2e3)},function(b){a.serverError=h("translate")("ERRORS.SMS."+b.data.ErrorCode),a.isExists=1,$(window).scrollTo(0,{duration:i.SCROLL_TO_UP_DURATION})})}}]),creditoControllers.controller("TermsController",["$window",function(a){}]),creditoControllers.controller("ForbiddenController",["$window",function(a){}]),creditoControllers.controller("EmailAndPasswordConfirmController",["$window","$scope","$route","EmailAndPasswordConfirmService","$timeout","$location",function(a,b,c,d,e,f){b.success=!1,b.error=!1,b.changePassword=function(){d.confirmPassword(c.current.params.userId,c.current.params.emailToken,c.current.params.passwordToken,b.change.retrypass.$viewValue).then(function(a){b.success=!0,e(function(){b.success=!1,f.path("login")},2e3)},function(a){b.error=!0,f.path("login")})}}]),creditoControllers.controller("CalculationController",["$scope","$rootScope","$route","$http","$timeout","$filter","UserDetails","Restangular","cfpLoadingBar","CalculationService","CONFIG","$location",function(a,b,c,d,e,f,g,h,i,j,k,l){a.showResults=!1;var m=$("form[name=calculation]");a.results={interesetPayment:"*",monthlyPayment:"*",duration:"*",payments:{graph:"",table:""},error:"",errorMessage:""},a.tableCollaterals={},a.calculationResult={},LS.investorSearchModel&&(a.borrower=JSON.parse(LS.investorSearchModel)),a.attributes={id:c.current.params.userId},a.CollateralModel=[{id:0,collateralType:null,collateralSize:null,fundCategory:null,expirationDate:null}],a.collateralRowsCounter=1,a.LoanLength=null,a.LoanType=null,a.PercentType=null,a.collateralsData={collaterals:null,loan:{loanSize:null,loanDuration:null,loanType:null,percentType:null}},a.data={},a.calculationModel={attributes:{}},a.calculationContainer=$("#calculation"),h.one("customerattributes/",g.getUserId()).get({customerId:a.attributes.id}).then(function(d){a.closeError(),a.closeAlert(),d&&(a.data=d,a.CollateralType=_.find(d,"name","CollateralType").optionAttributeValues,a.FundCategory=_.find(d,"name","FundCategory").optionAttributeValues,a.CollateralModel[0].fundCategory=a.FundCategory[2].value,_.each(d,function(b){var c=a.calculationContainer.find("input[name="+b.name+"], select[name="+b.name+"]");c.attr("attributeTypeID",b.attributeTypeID).attr("valueType",b.valueType);a.calculationModel.attributes[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType&&(a.calculationModel.attributes[b.name].options=[],_.each(b.optionAttributeValues,function(c,d){a.calculationModel.attributes[b.name].options.push({id:parseInt(c.optionAttributeValueID),value:f("translate")("SELECT_OPTIONS."+c.value),untranslatedValue:c.value})})),"undefined"!=typeof b.values&&("option"==b.valueType?a.calculationModel.attributes[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.calculationModel.attributes[b.name].value=parseFloat(b.values[0].value):"decimal"==b.valueType?a.calculationModel.attributes[b.name].value=parseInt(b.values[0].value):a.calculationModel.attributes[b.name].value=b.values[0].value)})),j.getCollaterals(c.current.params.userId).then(function(b){b.collaterals&&(a.CollateralModel=b.collaterals.slice(0,5),_.each(a.CollateralModel,function(b,c){_.each(b,function(b,d){"expirationDate"==d&&(a.CollateralModel[c].expirationDate=b.split("-").reverse().join("-").toString())})}),a.collateralRowsCounter=a.CollateralModel.length,a.collateralCalculate(),a.getLoanCalculation())},function(c){"CalculationFailedWithMessage"==c.data.ErrorCode?(a.serverError="",c.data.ErrorMessage.length>0&&(a.serverErrorObj=c.data.ErrorMessage.split("\n"),_.each(a.serverErrorObj,function(b,c){a.serverError+="<div>"+b+"</div><br />"})),b.isExists=!0):(a.serverError=f("translate")("ERRORS.CALCULATION."+c.data.ErrorCode),b.isExists=!0),$(window).scrollTo(0,{duration:k.SCROLL_TO_UP_DURATION})})}),a.collateralCalculate=function(){a.emptyData=!1,_.each(a.CollateralModel,function(b,c){_.each(b,function(b,c){null==b&&(a.emptyData=!0)})}),e(function(){"undefined"==typeof a.calculationModel.attributes.LoanType.value&&(a.calculationModel.attributes.LoanType.value=a.calculationModel.attributes.LoanType.options[0]),"undefined"==typeof a.calculationModel.attributes.PercentType.value&&(a.calculationModel.attributes.PercentType.value=a.calculationModel.attributes.PercentType.options[0]),"undefined"==typeof a.calculationModel.attributes.LoanLength.value&&(a.calculationModel.attributes.LoanLength.value=1),"undefined"==typeof a.calculationModel.attributes.LoanSize.value&&(a.calculationModel.attributes.LoanSize.value=0),a.emptyData||(a.collateralsData={collaterals:a.CollateralModel,loan:{loanSize:a.calculationModel.attributes.LoanSize.value,loanDuration:""+a.calculationModel.attributes.LoanLength.value,loanType:_.find(a.calculationModel.attributes.LoanType.options,"id",a.calculationModel.attributes.LoanType.value.id).untranslatedValue,percentType:_.find(a.calculationModel.attributes.PercentType.options,"id",a.calculationModel.attributes.PercentType.value.id).untranslatedValue}},a.collateralsData&&(a.unlinkedCollateralModel=angular.copy(a.CollateralModel),_.each(a.unlinkedCollateralModel,function(b,c){_.each(b,function(b,d){"expirationDate"==d&&b&&2==b.split("-")[0].length&&(a.unlinkedCollateralModel[c].expirationDate=b.split("-").reverse().join("-").toString())})}),a.collateralsData.collaterals=a.unlinkedCollateralModel,j.collateralCalculate(c.current.params.userId,a.collateralsData).then(function(b){a.emptyData=!1,a.calculationResult=b})))},200)},a.addCollateralRow=function(){a.collateralRowsCounter!=k.MAX_COLLATERALS_ROW&&(a.CollateralModel.push({collateralType:null,collateralSize:null,fundCategory:null,expirationDate:null}),a.CollateralModel[a.collateralRowsCounter].fundCategory=a.FundCategory[2].value,a.collateralRowsCounter++)},a.removeCollateralRow=function(b){"undefined"!=typeof a.CollateralModel[b].id&&j.removeCollateralRow(a.CollateralModel[b].id).then(function(){a.collateralCalculate()},function(a){console.log("errors",a)}),a.CollateralModel.splice(b,1),a.tableCollaterals={},a.showResults=!1,a.collateralRowsCounter--,1==a.collateralRowsCounter&&a.emptyData&&(a.calculationResult={}),a.collateralCalculate()},a.getFormData=function(a){var b=a.find("input, select"),c=[];return _.each(b,function(a,b){var d=$(a);"SELECT"==d.prop("tagName")&&isNaN(d.val())||d.val()&&d.attr("attributetypeid")&&c.push({name:a.name,value:"int"==d.attr("valuetype")?d.val().replace(/[\,]/g,""):d.val(),attributeTypeID:d.attr("attributetypeid"),valueType:d.attr("valuetype")})}),c},a.getCalculations=function(){a.formData=a.getFormData(m),_.find(a.formData,"name","SecuritySize").value=a.calculationResult.summary.availableAmount,j.setCustomersAttributes(g.getUserId(),a.formData,a.attributes.id).then(function(){a.getLoanCalculation()})},a.saveTextAsFile=function(a,b){function c(a){document.body.removeChild(a.target)}var d=navigator.userAgent.match(/MSIE\s([\d.]+)/),e=navigator.userAgent.match(/Trident\/7.0/)&&navigator.userAgent.match(/rv:11/),f=d?d[1]:e?11:-1;if(d&&10>f)return void console.log("No blobs on IE ver<10");var g=new Blob([b],{type:"application/pdf"});if(d||e)window.navigator.msSaveBlob(g,a);else{var h=document.createElement("a");h.download=a,h.innerHTML="Download File",null!=window.webkitURL?h.href=window.webkitURL.createObjectURL(g):(h.href=window.URL.createObjectURL(g),h.onclick=c,h.style.display="none",document.body.appendChild(h)),h.click()}},a.getReport=function(){j.getReport(g.getUserId(),a.attributes.id,a.changedCollateralsData).then(function(b){a.saveTextAsFile("report.pdf",b)})},a.getLoanCalculation=function(){a.collateralsData={collaterals:a.CollateralModel,loan:{loanSize:a.calculationModel.attributes.LoanSize.value,loanDuration:a.calculationModel.attributes.LoanLength.value,loanType:_.find(a.calculationModel.attributes.LoanType.options,"id",a.calculationModel.attributes.LoanType.value.id).untranslatedValue,percentType:_.find(a.calculationModel.attributes.PercentType.options,"id",a.calculationModel.attributes.PercentType.value.id).untranslatedValue}},a.changedCollateralsData=angular.copy(a.collateralsData),_.each(a.changedCollateralsData.collaterals,function(b,c){_.each(b,function(b,d){"expirationDate"==d&&(a.changedCollateralsData.collaterals[c].expirationDate=b.split("-").reverse().join("-"))})}),j.loanCalculate(a.changedCollateralsData,g.getUserId(),c.current.params.userId).then(function(b){if(a.closeError(),a.closeAlert(),e(function(){a.results.error="",a.results.errorMessage="",a.showResults=!0,a.results.interesetPayment=""+b.interesetPayment,a.results.maxInteresetPayment=""+b.maxInteresetPayment,a.results.monthlyPayment=""+b.monthlyPayment,a.results.duration=""+b.duration,a.results.payments.graph=b.graphAnswers,a.results.payments.table=b.tableAnswers,a.loanPercentType=a.changedCollateralsData.loan.percentType,
a.tableCollaterals=b.tableCollaterals},500),"undefined"!=typeof b.messages&&b.messages.length>0){a.results.alert=!0,a.results.alertMessage=[];for(var d=0;d<b.messages.length;d++)a.results.alertMessages[d]=b.messages[d].text;$(window).scrollTo(0,{duration:300})}j.getCollaterals(c.current.params.userId).then(function(b){b.collaterals&&(a.CollateralModel=b.collaterals.slice(0,5),_.each(a.CollateralModel,function(b,c){_.each(b,function(b,d){"expirationDate"==d&&(a.CollateralModel[c].expirationDate=b.split("-").reverse().join("-").toString())})}),a.collateralRowsCounter=a.CollateralModel.length)})},function(c){"CalculationFailedWithMessage"==c.data.ErrorCode?(a.serverError="",c.data.ErrorMessage.length>0&&(a.serverErrorObj=c.data.ErrorMessage.split("\n"),_.each(a.serverErrorObj,function(b,c){a.serverError+="<div>"+b+"</div><br />"})),b.isExists=!0):(a.serverError=f("translate")("ERRORS.CALCULATION."+c.data.ErrorCode),b.isExists=!0),a.results.error=c.data,a.results.errorMessage=c.data.ErrorMessage,a.showResults=!1,$(window).scrollTo(0,{duration:k.SCROLL_TO_UP_DURATION}),e(function(){i.complete(),a.showResults=!1},1e3)})},a.closeError=function(){a.results.error="",a.results.errorMessage="",b.isExists=!1,a.serverError=null},a.closeAlert=function(){a.results.alert=!1,a.results.alertMessages=[]},a.showModalArrearsBorrowers=function(){$("#arrearsBorrowers").fadeIn()},a.closeModalArrearsBorrowers=function(){$("#arrearsBorrowers").fadeOut()},a.borrowerDetails=function(a){l.path("investor/borrower-details/"+a)}}]),creditoControllers.controller("SearchController",["$scope","$rootScope","$http","Restangular","UserDetails","$location","$timeout","$filter","$route","CooperativeLoansService","ReportsAndDocumentsService","InvestorLoansService",function(a,b,c,d,e,f,g,h,i,j,k,l){a.getBorrowerPayments=function(b){l.getBorrowerPayments(b).then(function(b){a.borrowerPayments=b})},a.convertMonth=function(a){return 0==parseInt(a.split("")[0])?parseInt(a.split("")[1])-1:parseInt(a)-1},a.convertDay=function(a){return 0==parseInt(a.split("")[0])?parseInt(a.split("")[1]):parseInt(a)},LS.userId&&(a.userId=LS.userId),d.one("investorCustomers/"+JSON.parse(LS.user).id.toString()).get().then(function(b){_.each(b,function(b){var c=b.joinDate.split("-");b.personalScoreCreateDate.length>0?b.personalScoreCreateDate=new Date(b.personalScoreCreateDate):b.personalScoreCreateDate=new Date(0),b.joinDate=new Date(c[2],a.convertMonth(c[1]),a.convertDay(c[0]))}),a.borrowersList=b,a.sortType="joinDate",a.sortReverse=!0,a.searchBorrower=""},function(a){}),a.changeStatus=function(a){LS.borrowerData=JSON.stringify(a),localStorage.setItem("AllInOne",JSON.stringify(LS))},a.showCompletedBorrowers=LS.showCompletedBorrowers?LS.showCompletedBorrowers:!1,a.saveBorrowersFilter=function(a){LS.showCompletedBorrowers=a.showCompletedBorrowers,localStorage.setItem("AllInOne",JSON.stringify(LS))},a.calculate=function(){return"LoanReady"!==LS.borrowerDetails.status||0!=LS.borrowerDetails.redLightNote.length?!1:(a.searchModel={personalId:"",error:""},void d.one("user/"+e.getUserId()+"?personalId="+("undefined"!=typeof LS.borrowerDetails.userName?LS.borrowerDetails.userName:a.searchModel.personalId)).get().then(function(b){a.searchModel.found=!0,a.searchModel.error="",a.searchModel.customerId=b.id,a.searchModel.fname=b.firstName,a.searchModel.lname=b.lastName,a.searchModel.email=b.email,a.searchModel.phoneNumber=b.phoneNumber,a.searchModel.status=b.status,a.searchModel.redLightNote=0==b.redLightNote.length?h("translate")("SELECT_OPTIONS.No"):h("translate")("SELECT_OPTIONS.Yes"),a.searchModel.redLightFlag=b.redLightNote.length>0?1:0,a.searchModel.personalId="undefined"!=typeof LS.borrowerDetails.userName?LS.borrowerDetails.userName:a.searchModel.personalId,LS.investorSearchModel=JSON.stringify(a.searchModel),localStorage.setItem("AllInOne",JSON.stringify(LS)),g(function(){f.path("/calculation/"+LS.borrowerDetails.id)},500)},function(b){a.searchModel.found=!1,a.searchModel.error="User not found"}))},a.borrowerDetails=function(b){a.loanClicked=!0,a.borrowerStatus=b.borrower.status,LS.borrowerDetails=b.borrower,localStorage.setItem("AllInOne",JSON.stringify(LS)),a.id=LS.borrowerDetails.id,$(".nav-tabs li, .tab-pane").removeClass("active"),$(".borrowers-details").addClass("active"),j.getBorrower(a.id).then(function(b){a.borrowerModel={userDetails:{}},_.each(b,function(b){if(a.borrowerModel.userDetails[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var c=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof c?a.borrowerModel.userDetails[b.name]=h("translate")("SELECT_OPTIONS."+c.value):a.borrowerModel.userDetails[b.name]=""}else a.borrowerModel.userDetails[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.borrowerModel.userDetails[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.borrowerModel.userDetails[b.name].value=parseFloat(b.values[0].value):a.borrowerModel.userDetails[b.name].value=b.values[0].value)})}),j.getBorrowerBankAccount(a.id).then(function(b){a.bankAccountModel={},_.each(b,function(b){if(a.bankAccountModel[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var c=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof c?a.bankAccountModel[b.name]=h("translate")("SELECT_OPTIONS."+c.value):a.bankAccountModel[b.name]=""}else a.bankAccountModel[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.bankAccountModel[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.bankAccountModel[b.name].value=parseFloat(b.values[0].value):a.bankAccountModel[b.name].value=b.values[0].value)})}),a.getBorrowersDocuments=function(){j.getBorrowerDocuments(a.id).then(function(b){a.files=b})},a.downloadFile=function(b,c){k.getFile(b).then(function(b){a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(c))})},a.previewFile=function(b,c){k.getFile(b).then(function(b){switch(a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),a.urlCreator=window.URL||window.webkitURL,a.fileURL=a.urlCreator.createObjectURL(a.reader),$(".save").show(),b.type){case"image/png":case"image/jpg":case"image/jpeg":case"image/gif":$("#pdfRow").removeAttr("src").hide(),$("#imgRow").attr({src:a.fileURL}).show();break;case"application/pdf":case"application/x-pdf":$("#imgRow").removeAttr("src").hide(),$("#pdfRow").attr({src:a.fileURL}).show();break;default:a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(c))}})}},LS.saveAccordionTabsState&&0!=LS.saveAccordionTabsState.length||(LS.saveAccordionTabsState=[{id:"PersonalInfo"}]),_.each(LS.saveAccordionTabsState,function(a,b){$("#"+a.id).addClass("in")}),a.saveAccordionTabsState=function(b){a.isSaved=_.find(LS.saveAccordionTabsState,"id",b),a.isSaved?LS.saveAccordionTabsState=_.without(LS.saveAccordionTabsState,_.findWhere(LS.saveAccordionTabsState,{id:b})):LS.saveAccordionTabsState.push({id:b}),localStorage.setItem("AllInOne",JSON.stringify(LS))}}]),creditoControllers.controller("ChangeBorrowerStatusController",["$scope","Restangular","$routeParams","$location","$filter",function(a,b,c,d,e){a.borrower=JSON.parse(LS.borrowerData),a.statuses=[{name:e("translate")("BUTTONS.CHANGE"),value:""},{name:e("translate")("SEARCH.NotRelevant"),value:"NotRelevant"},{name:e("translate")("SEARCH.LoanCompleted"),value:"LoanCompleted"}],a.statusModel=a.statuses[0].value,$("#changeStatus").find("option[value="+a.borrower.status+"]").attr({selected:"selected"}),a.changeStatus=function(c){a.showSuccessMessage=!1,b.all("borrowerstatus/"+parseInt(a.borrower.id)+"?status="+(c?"BackToPrevious":a.statusModel)).post().then(function(){a.showSuccessMessage=!0,setTimeout(function(){a.showSuccessMessage=!1,delete LS.borrowerData,localStorage.setItem("AllInOne",JSON.stringify(LS)),d.path("investor/search")},500)},function(a){})},a.backToBT=function(){delete LS.borrowerData,localStorage.setItem("AllInOne",JSON.stringify(LS)),d.path("investor/search")}}]),creditoControllers.controller("InvestorConfigCollateralsController",["$scope","$timeout","InvestorConfigService","CONFIG",function(a,b,c,d){a.collateralsConfigModel={},c.getCollateralsConfig().then(function(b){a.collateralsConfigModel=b}),a.collateralConfigSubmit=function(e,f){a.data=[],_.each(a.collateralsConfigModel[e].subCategories[f].values,function(b,c){a.data.push({Id:b.id,MaxLoanDurationMonths:b.maxLoanDurationMonths,MinLoanAmount:b.minLoanAmount,MaxLoanAmount:b.maxLoanAmount,MinLoanAmountInPercent:b.minLoanAmountInPercent,MaxLoanAmountInPercent:b.maxLoanAmountInPercent})}),c.submitCollateralConfig(a.data).then(function(c){a.savedSuccess=!0,$(window).scrollTo(0,{duration:d.SCROLL_TO_UP_DURATION}),b(function(){a.savedSuccess=!1},2e3)})}}]),creditoControllers.controller("InvestorConfigLoanController",["$scope","$timeout","InvestorConfigService","CONFIG",function(a,b,c,d){a.loanConfigModel={},a.data=[],c.getLoanConfig().then(function(b){a.loanConfigModel=b}),a.loanConfigSubmit=function(e){_.each(a.loanConfigModel[e].values,function(e){a.data.push({Id:e.id,minLoanAmountInPercent:e.minLoanAmountInPercent,minLoanAmount:e.minLoanAmount,maxLoanDurationMonths:e.maxLoanDurationMonths,maxLoanAmountInPercent:e.maxLoanAmountInPercent,maxLoanAmount:e.maxLoanAmount,loanType:e.loanType}),c.submitLoanConfig(a.data).then(function(c){a.savedSuccess=!0,$(window).scrollTo(0,{duration:d.SCROLL_TO_UP_DURATION}),b(function(){a.savedSuccess=!1},2e3)})})}}]),creditoControllers.controller("InvestorConfigGeneralController",["$scope","$timeout","InvestorConfigService","$location","$filter",function(a,b,c,d,e){a.configGeneralPage=$("#configGeneralPage"),a.investorAttributesModel={attributes:{}},a.RedLightsConditions=[{name:"לא",value:"False"},{name:"כן",value:"True"}],$("#changeRedLightsConditions").find("option[value="+a.RedLightsConditions.value+"]").attr({selected:"selected"}),c.getInvestorAttributes().then(function(b){a.showSuccessMessage=!1,a.investorAttributes=b,a.redLightsNoteObj=_.find(a.investorAttributes,"name","IgnoreRedLightNote"),"undefined"!=typeof a.redLightsNoteObj.values&&(a.redLightsModel=a.redLightsNoteObj.values[0].value),_.each(a.investorAttributes,function(b){var c=a.configGeneralPage.find("input[name="+b.name+"], select[name="+b.name+"]");c.attr("attributeTypeID",b.attributeTypeID).attr("valueType",b.valueType);a.investorAttributesModel.attributes[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType&&(a.calculationModel.attributes[b.name].options=[],_.each(b.optionAttributeValues,function(c,d){a.investorAttributesModel.attributes[b.name].options.push({id:parseInt(c.optionAttributeValueID),value:e("translate")("SELECT_OPTIONS."+c.value),untranslatedValue:c.value})})),"undefined"!=typeof b.values&&("option"==b.valueType?a.investorAttributesModel.attributes[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.investorAttributesModel.attributes[b.name].value=parseFloat(b.values[0].value):"decimal"==b.valueType?a.investorAttributesModel.attributes[b.name].value=parseInt(b.values[0].value):a.investorAttributesModel.attributes[b.name].value=b.values[0].value)})}),a.saveLoanConditions=function(){a.loanConditions=[],_.each(a.investorAttributesModel.attributes,function(b,c){if("MinLoanPercentDiff"==c){var d="option"==b.valueType?b.value.id:b.value;a.loanConditions.push({value:""+d,attributeTypeID:b.attributeTypeID})}"IgnoreRedLightNote"==c&&a.loanConditions.push({value:a.redLightsModel,attributeTypeID:b.attributeTypeID})}),c.saveAttributes(a.loanConditions).then(function(c){a.showSuccessMessage=!0,b(function(){a.showSuccessMessage=!1},2e3)})},a.changeReportPassword=function(){c.changeReportPassword(a.oldPassword,a.password,a.retrypass).then(function(c){a.showSuccessMessagePassword=!0,b(function(){a.showSuccessMessagePassword=!1},2e3)},function(c){a.change.oldPassword.$setValidity("incorrect",!1),b(function(){a.change.oldPassword.$setValidity("incorrect",!0),a.oldPassword=""},3e3)})}}]),creditoControllers.controller("BorrowerDetailsController",["$scope","CooperativeLoansService","$filter","ReportsAndDocumentsService","$route","$window",function(a,b,c,d,e,f){a.id=e.current.params.borrowerId,$(".nav-tabs li, .tab-pane").removeClass("active"),$(".borrowers-details").addClass("active"),b.getBorrower(a.id).then(function(b){a.borrowerModel={userDetails:{}},_.each(b,function(b){if(a.borrowerModel.userDetails[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var d=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof d?a.borrowerModel.userDetails[b.name]=c("translate")("SELECT_OPTIONS."+d.value):a.borrowerModel.userDetails[b.name]=""}else a.borrowerModel.userDetails[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.borrowerModel.userDetails[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.borrowerModel.userDetails[b.name].value=parseFloat(b.values[0].value):a.borrowerModel.userDetails[b.name].value=b.values[0].value)})}),b.getBorrowerBankAccount(a.id).then(function(b){a.bankAccountModel={},_.each(b,function(b){if(a.bankAccountModel[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var d=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof d?a.bankAccountModel[b.name]=c("translate")("SELECT_OPTIONS."+d.value):a.bankAccountModel[b.name]=""}else a.bankAccountModel[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.bankAccountModel[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.bankAccountModel[b.name].value=parseFloat(b.values[0].value):a.bankAccountModel[b.name].value=b.values[0].value)})}),a.getBorrowersDocuments=function(){b.getBorrowerDocuments(a.id).then(function(b){a.files=b})},a.downloadFile=function(b,c){d.getFile(b).then(function(b){a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(c))})},a.previewFile=function(b,c){d.getFile(b).then(function(b){switch(a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),a.urlCreator=window.URL||window.webkitURL,a.fileURL=a.urlCreator.createObjectURL(a.reader),$(".save").show(),b.type){case"image/png":case"image/jpg":case"image/jpeg":case"image/gif":$("#pdfRow").removeAttr("src").hide(),$("#imgRow").attr({src:a.fileURL}).show();break;case"application/pdf":case"application/x-pdf":$("#imgRow").removeAttr("src").hide(),$("#pdfRow").attr({src:a.fileURL}).show();break;default:a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(c))}})},LS.saveAccordionTabsState&&0!=LS.saveAccordionTabsState.length||(LS.saveAccordionTabsState=[{id:"PersonalInfo"}]),_.each(LS.saveAccordionTabsState,function(a,b){$("#"+a.id).addClass("in")}),a.saveAccordionTabsState=function(b){a.isSaved=_.find(LS.saveAccordionTabsState,"id",b),a.isSaved?LS.saveAccordionTabsState=_.without(LS.saveAccordionTabsState,_.findWhere(LS.saveAccordionTabsState,{id:b})):LS.saveAccordionTabsState.push({id:b}),localStorage.setItem("AllInOne",JSON.stringify(LS))},a.back=function(){f.history.back()}}]),creditoControllers.controller("InvestorStatusController",["$scope","InvestorStatusService","$filter","$route","$window",function(a,b,c,d,e){b.getStatus().then(function(b){a.statusSummary=b},function(a){console.log(a)}),b.getPortfolioInfo().then(function(b){a.portfolioInfo=b},function(a){console.log(a)})}]),creditoControllers.controller("InvestorCashFlowController",["$scope","InvestorStatusService","CashFlowService",function(a,b,c){b.getPortfolioInfo().then(function(b){a.portfolioInfo=b},function(a){console.log(a)}),c.getCashFlow().then(function(b){a.cashFlowModel=b})}]),creditoControllers.controller("InvestorStatisticsController",["$scope","InvestorStatisticsService","InvestorStatusService",function(a,b,c){c.getPortfolioInfo().then(function(b){a.portfolioInfo=b},function(a){console.log(a)}),b.getStatistics().then(function(b){a.statisticsModel=b})}]),creditoControllers.controller("InvestorReportAndDocumentsController",["$scope","BorrowerReportsAndDocumentsService",function(a,b){a.drawFile=function(c,d){b.getFileFromGoogle(c).then(function(b){switch("undefined"!=typeof Blob&&(a.reader=new Blob([b],{type:d}),a.urlCreator=window.URL,a.fileURL=a.urlCreator.createObjectURL(a.reader),a.fileName=c,document.getElementById("pdfRow").src=a.fileURL,"undefined"!=typeof window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(a.reader)),d){case"image/png":case"image/jpg":case"image/bmp":case"image/jpeg":$("#pdfRow").removeAttr("src").hide(),$("#imgRow").attr({src:a.fileURL}).show();break;case"application/pdf":case"application/x-pdf":$("#imgRow").removeAttr("src").hide(),$("#pdfRow").attr({src:a.fileURL}).show()}})},a.saveFile=function(){saveAs(a.reader,decodeURIComponent(a.fileName))}}]),creditoControllers.controller("InvestorLoansController",["$scope","InvestorLoansService","CooperativeLoansService","$filter","$route","ReportsAndDocumentsService","$location",function(a,b,c,d,e,f,g){a.investorId=JSON.parse(LS.user).id,a.filterStatus=g.path().split("/")[3]||null,b.getBorrowersList(a.investorId).then(function(b){a.borrowersList=b,a.sortType="joinDate",a.sortReverse=!0,a.searchBorrower=""},function(a){console.log("e",a)}),a.borrowerDetails=function(b){a.loanClicked=!0,a.clickedBorrowerId=b.borrower.borrowerId,a.borrowerStatus=b.borrower.status,LS.borrowerDetails=b.borrower,localStorage.setItem("AllInOne",JSON.stringify(LS)),a.borrowerId=LS.borrowerDetails.borrowerId,$(".nav-tabs li, .tab-pane").removeClass("active"),$(".borrowers-details").addClass("active"),c.getBorrower(a.borrowerId).then(function(b){a.borrowerModel={userDetails:{}},_.each(b,function(b){if(a.borrowerModel.userDetails[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var c=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof c?a.borrowerModel.userDetails[b.name]=d("translate")("SELECT_OPTIONS."+c.value):a.borrowerModel.userDetails[b.name]=""}else a.borrowerModel.userDetails[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.borrowerModel.userDetails[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.borrowerModel.userDetails[b.name].value=parseFloat(b.values[0].value):a.borrowerModel.userDetails[b.name].value=b.values[0].value)})})},a.getBorrowersDocuments=function(){c.getBorrowerDocuments(a.borrowerId).then(function(b){a.files=b})},a.downloadFile=function(b,c){f.getFile(b).then(function(b){a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(c))})},a.getBorrowerPayments=function(){b.getBorrowerPayments(a.borrowerId).then(function(b){a.borrowerPayments=b})}}]),creditoControllers.controller("LoanApprovalsController",["$scope","InvestorLoansService","CooperativeLoansService","$filter","$route","ReportsAndDocumentsService","$location",function(a,b,c,d,e,f,g){a.investorId=JSON.parse(LS.user).id,a.filterStatus=g.path().split("/")[3]||null,a.approveFlag=!1,a.approveComment="",a.investorId=LS.userId,a.investorName=JSON.parse(LS.user).firstName+" "+JSON.parse(LS.user).lastName,a.ApproveCheckbox_1=!1,a.ApproveCheckbox_2=!1,a.ApproveCheckbox_3=!1,a.approvalModel=[],a.approved=!1,b.getBorrowersList(a.investorId).then(function(b){a.borrowersList=b,a.sortType="joinDate",a.sortReverse=!0,a.searchBorrower=""},function(a){console.log("e",a)}),a.showModalMessage=function(b){a.approveFlag=b,$("#messageModal").modal()},a.commentSubmit=function(){a.approvalModel={approveeFirstName:JSON.parse(LS.user).firstName,approveeLastName:JSON.parse(LS.user).lastName,comment:a.approveComment,date:new Date},a.approved=!0},a.approveLoanModal=function(){$("#approveLoanModal").modal()},a.getApprovals=function(){},a.borrowerDetails=function(b){a.approvalModel=[],a.approved=!1,a.loanClicked=!0,a.clickedBorrowerId=b.borrower.borrowerId,a.borrowerStatus=b.borrower.status,LS.borrowerDetails=b.borrower,localStorage.setItem("AllInOne",JSON.stringify(LS)),a.borrowerId=LS.borrowerDetails.borrowerId,a.loanId=LS.borrowerDetails.loanId,$(".nav-tabs li, .tab-pane").removeClass("active"),$(".borrowers-details").addClass("active"),c.getBorrower(a.borrowerId).then(function(b){a.borrowerModel={userDetails:{}},_.each(b,function(b){if(a.borrowerModel.userDetails[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var c=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof c?a.borrowerModel.userDetails[b.name]=d("translate")("SELECT_OPTIONS."+c.value):a.borrowerModel.userDetails[b.name]=""}else a.borrowerModel.userDetails[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.borrowerModel.userDetails[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.borrowerModel.userDetails[b.name].value=parseFloat(b.values[0].value):a.borrowerModel.userDetails[b.name].value=b.values[0].value)})}),c.getBorrowerBankAccount(a.borrowerId).then(function(b){a.bankAccountModel={},_.each(b,function(b){if(a.bankAccountModel[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType)if("undefined"!=typeof b.values){var c=_.find(b.optionAttributeValues,"optionAttributeValueID",parseInt(b.values[0].value));"undefined"!=typeof c?a.bankAccountModel[b.name]=d("translate")("SELECT_OPTIONS."+c.value):a.bankAccountModel[b.name]=""}else a.bankAccountModel[b.name]="";"undefined"!=typeof b.values&&("option"==b.valueType?a.bankAccountModel[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.bankAccountModel[b.name].value=parseFloat(b.values[0].value):a.bankAccountModel[b.name].value=b.values[0].value)})})},a.getBorrowersDocuments=function(){c.getBorrowerDocuments(a.borrowerId).then(function(b){a.files=b})},a.downloadFile=function(b,c){f.getFile(b).then(function(b){a.fileType=b.type,a.reader=new Blob([b],{type:b.type}),saveAs(a.reader,decodeURIComponent(c))})},a.getBorrowerPayments=function(){b.getBorrowerPayments(a.borrowerId).then(function(b){a.borrowerPayments=b})},LS.saveAccordionTabsState&&0!=LS.saveAccordionTabsState.length||(LS.saveAccordionTabsState=[{id:"PersonalInfo"}]),_.each(LS.saveAccordionTabsState,function(a,b){$("#"+a.id).addClass("in")}),a.saveAccordionTabsState=function(b){a.isSaved=_.find(LS.saveAccordionTabsState,"id",b),a.isSaved?LS.saveAccordionTabsState=_.without(LS.saveAccordionTabsState,_.findWhere(LS.saveAccordionTabsState,{id:b})):LS.saveAccordionTabsState.push({id:b}),localStorage.setItem("AllInOne",JSON.stringify(LS))}}]),creditoControllers.controller("LoanPaymentsController",["$scope","LoanPaymentsService","$filter",function(a,b,c){a.loanPaymentsModel=[],b.getPayments().then(function(b){_.each(b,function(b){null==b.succeeded?b.isSucceeded="":b.isSucceeded=b.succeeded?c("translate")("SELECT_OPTIONS.Payments_Yes"):c("translate")("SELECT_OPTIONS.No"),a.loanPaymentsModel.push(b)})})}]),creditoControllers.controller("BorrowerLoanProccessStatusController",["$scope","BorrowerLoanProccessStatusService","$filter",function(a,b,c){b.getStatus().then(function(b){a.statusModel=b})}]),creditoControllers.controller("BorrowerLoanRecyclingController",["$scope","$location","BorrowerLoanRecyclingService","$filter",function(a,b,c,d){a.loanAmount=null,a.finish=function(){LS.finishLoanFlag=1,localStorage.setItem("AllInOne",JSON.stringify(LS)),b.path("borrower-status")}}]),creditoControllers.controller("EarlyPaymentController",["$scope","EarlyPaymentService","CONFIG","$filter","$location","$timeout",function(a,b,c,d,e,f){a.earlyPaymentModel=null,a.chooseDate=function(){a.borrowerModel={bankAccount:{BankBranchName:null,BankAccountNumber:null,BankNameList:[],CreditCardOwnership:[],YearsInAccount:null},loanDetails:{LoanAmount:{value:null}}},a.bankAccountContainer=$("#bankAccount"),a.yearsLimit=[];for(var e=0;e<=c.MAX_YEAR_LIMIT;e++)a.yearsLimit.push(e);b.getBankAccount().then(function(b){_.each(b,function(b){var c=a.bankAccountContainer.find("input[name="+b.name+"]");c.attr("attributeTypeID",b.attributeTypeID).attr("valueType",b.valueType),a.borrowerModel.bankAccount[b.name]={name:b.name,isChanged:!1,valueType:b.valueType,attributeTypeID:b.attributeTypeID},"option"==b.valueType&&(a.borrowerModel.bankAccount[b.name].options=[],_.each(b.optionAttributeValues,function(c,e){a.borrowerModel.bankAccount[b.name].options.push({id:parseInt(c.optionAttributeValueID),value:d("translate")("SELECT_OPTIONS."+c.value)})})),"undefined"!=typeof b.values&&("option"==b.valueType?a.borrowerModel.bankAccount[b.name].value={id:parseInt(b.values[0].value)}:"int"==b.valueType?a.borrowerModel.bankAccount[b.name].value=parseFloat(b.values[0].value):"decimal"==b.valueType?a.borrowerModel.bankAccount[b.name].value=parseInt(b.values[0].value):a.borrowerModel.bankAccount[b.name].value=b.values[0].value)})}),b.getLoanAmount().then(function(b){b&&(a.borrowerModel.loanDetails.LoanAmount={name:"LoanAmount",isChanged:!1,valueType:"int",attributeTypeID:""},a.borrowerModel.loanDetails.LoanAmount.value=parseFloat(b.amount))})},a.showModal=function(){$("#earlyPaymentModal").modal()},a.acceptEarlyPayment=function(){LS.earlyPaymentFlag=1,localStorage.setItem("AllInOne",JSON.stringify(LS)),f(function(){e.path("loan-recycling")},500)}}]),creditoControllers.controller("DashboardController",["$scope",function(a){}]),creditoControllers.controller("FAQController",["$scope","FAQService","$location","$timeout","CONFIG",function(a,b,c,d,e){a.categoryId=null,a.categoryDeleted=!1,a.editorOptions={language:"he",uiColor:"#000000"},b.getCategories().then(function(b){a.FAQModel=b}),a.createCategory=function(){c.path("admin/faq/category/create")},a.editCategory=function(a){c.path("admin/faq/category/edit/"+a)},a.deleteCategoryModal=function(b){a.categoryId=b,$("#confirmDeleteModal").modal()},a.deleteCategory=function(){b.deleteCategory(a.categoryId).then(function(){a.categoryDeleted=!0,$(window).scrollTo(0,{duration:e.SCROLL_TO_UP_DURATION}),d(function(){a.categoryDeleted=!1},1e3),b.getCategories().then(function(b){a.FAQModel=b})})},a.deleteArticleModal=function(b){a.articleId=b,$("#confirmArticleDeleteModal").modal()},a.deleteArticle=function(){b.deleteArticle(a.articleId).then(function(){a.articleDeleted=!0,$(window).scrollTo(0,{duration:e.SCROLL_TO_UP_DURATION}),d(function(){a.articleDeleted=!1},1e3),b.getCategories().then(function(b){a.FAQModel=b})})},a.editArticle=function(a){a||c.path("admin/faq"),c.path("admin/faq/article/edit/"+a)},a.createArticle=function(){c.path("admin/faq/article/create")}}]),creditoControllers.controller("BorrowerFAQController",["$scope","FAQService","$location","$route","$timeout","CONFIG",function(a,b,c,d,e,f){a.FAQModel=[],b.getCategories().then(function(b){a.FAQModel=b,a.flagParent=[],a.flagChild=[],a.tag=d.current.params.id,e(function(){a.parentCategoryId=$("."+a.tag).attr("categoryId"),a.articleId=$("."+a.tag).attr("articleId"),a.parent=$("#subCategory_"+a.parentCategoryId).attr("parentId"),$("#answers_"+a.articleId).addClass("in"),$("#subCategory_"+a.parentCategoryId).addClass("in"),"undefined"!=typeof a.parent?$("#parentCategory_"+a.parent).addClass("in"):$("#parentCategory_"+a.parentCategoryId).addClass("in"),$(window).scrollTo($("."+a.tag),{duration:f.SCROLL_TO_UP_DURATION})},500)})}]),creditoControllers.controller("FAQCategoryCreateController",["$scope","FAQService","$timeout","$location","CONFIG",function(a,b,c,d,e){a.FAQModelCategories=[],a.categoryName="",a.categoryCreated=!1,b.getCategories().then(function(b){_.each(b,function(b,c){a.FAQModelCategories.push({id:b.id,Name:b.categoryName})})}),a.createCategory=function(){a.data={Name:a.categoryName,ParentId:a.FAQModelCategoriesSelected?a.FAQModelCategoriesSelected.id:null},b.createCategory(a.data).then(function(b){a.categoryCreated=!0,$(window).scrollTo(0,{duration:e.SCROLL_TO_UP_DURATION}),c(function(){a.categoryCreated=!1,d.path("admin/faq")},1e3)})}}]),creditoControllers.controller("FAQCategoryEditController",["$scope","FAQService","$timeout","$location","$route","CONFIG",function(a,b,c,d,e,f){a.FAQModelCategories=[{Name:""}],a.categoryName="",a.categoryUpdated=!1,a.categoryId=e.current.params.id,b.getCategories().then(function(b){_.each(b,function(b,c){a.FAQModelCategories.push({id:b.id,Name:b.categoryName})})}),b.getCategoryById(a.categoryId).then(function(b){b.parentId&&c(function(){a.findParentCategory=_.find(a.FAQModelCategories,"id",b.parentId),a.findParentCategory&&(a.FAQModelCategoriesSelected=a.findParentCategory)},500),a.categoryName=b.categoryName}),a.updateCategory=function(){a.data={Id:a.categoryId,Name:a.categoryName,ParentId:a.FAQModelCategoriesSelected?a.FAQModelCategoriesSelected.id:null},b.updateCategory(a.data).then(function(b){a.categoryUpdated=!0,$(window).scrollTo(0,{duration:f.SCROLL_TO_UP_DURATION}),c(function(){a.categoryUpdated=!1,d.path("admin/faq")},1e3)})}}]),creditoControllers.controller("FAQArticleCreateController",["$scope","FAQService","$timeout","$location","CONFIG",function(a,b,c,d,e){a.articleModel="",a.FAQModelCategories=[],a.FAQModelSubCategories=[],a.articleCreated=!1,a.editorOptions={language:"he"},CKEDITOR.config.extraPlugins="base64image",CKEDITOR.config.skin="office2013",CKEDITOR.config.height="400px",b.getCategories().then(function(b){_.each(b,function(b,c){a.FAQModelCategories.push({id:b.id,Name:b.categoryName})})}),a.selectChildCategoriesById=function(c){b.getCategoryById(a.FAQModelCategoriesSelected.id).then(function(b){a.FAQModelSubCategories=[],_.each(b.subCategories,function(b,c){a.FAQModelSubCategories.push({id:b.id,Name:b.categoryName})})})},a.create=function(){a.data={CategoryId:a.FAQModelSubCategoriesSelected?a.FAQModelSubCategoriesSelected.id:a.FAQModelCategoriesSelected.id,Title:a.articleTitle,Text:a.articleModel,Tag:a.articleTag},b.createArticle(a.data).then(function(b){a.articleCreated=!0,$(window).scrollTo(0,{duration:e.SCROLL_TO_UP_DURATION}),c(function(){a.articleCreated=!1,d.path("admin/faq")},1e3)})}}]),creditoControllers.controller("FAQArticleEditController",["$scope","FAQService","$route","$timeout","$location","CONFIG",function(a,b,c,d,e,f){a.articleModel="",a.FAQModelCategories=[],a.FAQModelCategoriesSelected=[],a.FAQModelSubCategories=[{id:"",Name:""}],a.articleUpdated=!1,a.articleId=c.current.params.id,a.editorOptions={language:"he"},CKEDITOR.config.extraPlugins="base64image",CKEDITOR.config.skin="office2013",CKEDITOR.config.height="400px",b.getArticleById(a.articleId).then(function(c){a.articleModel=c.text,a.articleTag=c.tag,a.articleTitle=c.title,b.getCategories().then(function(b){_.each(b,function(b,c){a.FAQModelCategories.push({id:b.id,Name:b.categoryName})})}),b.getCategoryById(c.categoryId).then(function(c){c.parentId?b.getCategoryById(c.parentId).then(function(c){d(function(){a.FAQModelCategoriesSelected=_.find(a.FAQModelCategories,"id",c.id),b.getCategoryById(a.FAQModelCategoriesSelected.id).then(function(b){_.each(b.subCategories,function(b,c){a.FAQModelSubCategories.push({id:b.id,Name:b.categoryName})}),a.FAQModelSubCategoriesSelected=_.find(a.FAQModelSubCategories,"id",b.categoryId)})},500)}):d(function(){a.FAQModelCategoriesSelected=_.find(a.FAQModelCategories,"id",c.id),b.getCategoryById(a.FAQModelCategoriesSelected.id).then(function(b){_.each(b.subCategories,function(b,c){a.FAQModelSubCategories.push({id:b.id,Name:b.categoryName})}),b.parentId?a.FAQModelSubCategoriesSelected=_.find(a.FAQModelSubCategories,"id",b.categoryId):a.FAQModelSubCategoriesSelected=a.FAQModelSubCategories[0];
})},500)})}),a.selectChildCategoriesById=function(c){a.FAQModelSubCategories=[],b.getCategoryById(a.FAQModelCategoriesSelected.id).then(function(b){_.each(b.subCategories,function(b,c){a.FAQModelSubCategories.push({id:b.id,Name:b.categoryName})})})},a.update=function(){a.data={Id:a.articleId,CategoryId:a.FAQModelSubCategoriesSelected&&""!=a.FAQModelSubCategoriesSelected.id?a.FAQModelSubCategoriesSelected.id:a.FAQModelCategoriesSelected.id,Title:a.articleTitle,Text:a.articleModel,Tag:a.articleTag},b.updateArticle(a.data).then(function(){a.articleUpdated=!0,$(window).scrollTo(0,{duration:f.SCROLL_TO_UP_DURATION}),d(function(){a.articleUpdated=!1},1e3)})}}]);var creditoServices=angular.module("creditoServices",["ngResource"]);creditoServices.factory("FAQService",["Restangular",function(a){return{getCategories:function(){return a.one("faq").get()},createCategory:function(b){return a.one("faq").all("category").post(b)},getCategoryById:function(b){return a.one("faq").one("category",b).get()},updateCategory:function(b){return a.one("faq").one("category").customPUT(b)},deleteCategory:function(b){return a.one("faq").one("category",b).remove()},selectChildCategoriesById:function(b){return a.one("faq").one("category",b).get()},createArticle:function(b){return a.one("faq").all("answer").post(b)},getArticleById:function(b){return a.one("faq").one("answer",b).get()},updateArticle:function(b){return a.one("faq").one("answer").customPUT(b)},deleteArticle:function(b){return a.one("faq").one("answer",b).remove()}}}]),creditoServices.factory("CalculationService",["Restangular",function(a){return{collateralCalculate:function(b,c){return a.all("collateralcalc").post(c,{borrowerId:b})},loanCalculate:function(b,c,d){return a.one("loancalc").all(c).post(b,{borrowerId:d})},setCustomersAttributes:function(b,c,d){return a.one("customerattributes").all(b).post(c,{customerId:d})},getReport:function(b,c,d){return a.one("report",b).withHttpConfig({responseType:"blob"}).get({customerId:c,collaterals:JSON.stringify(d)})},getCollaterals:function(b){return a.one("user",b).one("collaterals").get()},removeCollateralRow:function(b){return a.one("deletecollateral",b).remove()}}}]),creditoServices.factory("InvestorConfigService",["Restangular",function(a){return{getCollateralsConfig:function(){return a.one("collateralconfig").get()},getLoanConfig:function(){return a.one("loanconfig").get()},submitCollateralConfig:function(b){return a.all("collateralconfig").post(b)},submitLoanConfig:function(b){return a.all("loanconfig").post(b)},changeReportPassword:function(b,c,d){return a.all("ChangeReportPassword").post({OldPassword:b,newPassword:c,confirmPassword:d})},getInvestorAttributes:function(){return a.one("investor").one("attributes").get()},saveAttributes:function(b){return a.one("investor").all("attributes").post(b)}}}]),creditoServices.factory("InvestorStatusService",["Restangular","$rootScope",function(a,b){return{getStatus:function(){return a.one("investor").one("status").get()},getPortfolioInfo:function(){return a.one("investor").one("status").one("portfolioInfo").get()}}}]),creditoServices.factory("CashFlowService",["Restangular","$rootScope",function(a,b){return{getCashFlow:function(){return a.one("investor").one("cashflow").get()}}}]),creditoServices.factory("InvestorStatisticsService",["Restangular","$rootScope",function(a,b){return{getStatistics:function(){return a.one("investor").one("statistics").get()}}}]),creditoServices.factory("InvestorLoansService",["Restangular","$rootScope",function(a,b){return{getBorrowersList:function(){return a.one("investor").one("loans").get()},getBorrowerPayments:function(b){return a.one("paymentcalc",LS.userId).get({customerId:b})},approveLoan:function(b,c){return a.one("loan").all("approve").post({loanid:b,comment:c})},declineLoan:function(b,c){return a.one("loan").all("decline").post({loanid:b,comment:c})},getApprovals:function(b){return a.one("loan",b).one("approvals").get()}}}]),creditoServices.factory("LoanPaymentsService",["Restangular","$rootScope",function(a,b){return{getPayments:function(){return a.one("borrower").one("payments").get()}}}]),creditoServices.factory("EarlyPaymentService",["Restangular","$rootScope",function(a,b){return{getBankAccount:function(){return a.one("account").one("attributes").get()},getLoanAmount:function(){return a.one("loan").get()}}}]),creditoServices.factory("BorrowerLoanProccessStatusService",["Restangular","$rootScope",function(a,b){return{getStatus:function(){return a.one("borrower").one("status").get()}}}]),creditoServices.factory("BorrowerLoanRecyclingService",["Restangular","$rootScope",function(a,b){return{}}]),creditoServices.factory("BorrowerReportsAndDocumentsService",["$rootScope","CONFIG","$q",function(a,b,c){return{getDocuments:function(a){$("#documentsAndReports").find(".text").text("Loading file");var d=c.defer();return $.ajax({url:b.SITE_URL+"/assets/reports/new-docs/"+a,type:"GET",dataType:"binary",async:!1,processData:!1,success:function(a){d.resolve(a)}}),d.promise},getUploadedDocuments:function(a){var d=c.defer();return $.ajax({url:b.API_URL+"attribute/"+a+"/download",type:"GET",dataType:"binary",ignoreLoadingBar:!1,async:!0,headers:{Authorization:"Bearer "+LS.token},processData:!1,success:function(a){d.resolve(a)},error:function(a){console.log("e",a)}}),d.promise},getDocumentsDigitalSignature:function(a){$("#documentsAndReports").find(".text").text("Loading file");var d=c.defer();return $.ajax({url:b.SITE_URL+"/api/borrower/documents/htmlToPdf?attributeTypeName="+a,headers:{Authorization:"Bearer "+LS.token},type:"GET",dataType:"binary",async:!1,processData:!1,success:function(a){d.resolve(a)}}),d.promise},getDocumentsSignature:function(a){$("#documentsAndReports").find(".text").text("Loading file");var d=c.defer();return $.ajax({url:b.SITE_URL+"/assets/reports/new-docs-digital-signature/"+a,type:"GET",dataType:"binary",async:!1,processData:!1,success:function(a){d.resolve(a)}}),d.promise},downloadFile:function(a){var d=c.defer();return $.ajax({url:b.SITE_URL+"/assets/reports/new-docs-digital-signature/"+a,type:"GET",dataType:"binary",ignoreLoadingBar:!1,async:!0,headers:{Authorization:"Bearer "+LS.token},processData:!1,success:function(a){d.resolve(a)},error:function(a){}}),d.promise},getFileFromGoogle:function(a){$("#documentsAndReports").find(".text").text("Loading file");var d=c.defer();return $.ajax({url:b.SITE_URL+"/assets/reports/"+a,type:"GET",dataType:"binary",async:!1,processData:!1,success:function(a){d.resolve(a)}}),d.promise}}}]),creditoServices.factory("SmsMessageVerificationService",["Restangular",function(a){return{confirmation:function(b){return a.one("user").one("sms").all("confirmation").post({code:b},{},{Authorization:"Bearer "+LS.tmpToken,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0})},resendSms:function(b){return a.one("user").one("sms").all("resend").post({phone:b},{},{Authorization:"Bearer "+LS.tmpToken,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0})},getSmsCode:function(){return a.one("user").one("sms").all("code").post({},{},{Authorization:"Bearer "+LS.tmpToken,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0})}}}]);var creditoDirectives=angular.module("creditoDirectives",[]);creditoDirectives.directive("ckEditor",[function(){return{require:"?ngModel",link:function(a,b,c,d){var e=CKEDITOR.replace(b[0]);e.on("pasteState",function(){a.$apply(function(){d.$setViewValue(e.getData())})}),d.$render=function(a){e.setData(d.$modelValue)}}}}]),creditoDirectives.directive("adminNavMenu",function(){return{restrict:"EA",templateUrl:"templates/pages/admin/nav-menu.html"}}),creditoDirectives.directive("datePickerCollateral",[function(){return{restrict:"EA",link:function(a,b,c,d){a.$watch(b,function(){setTimeout(function(){$(".datepickerCollateral").datepicker({format:"dd-mm-yyyy",todayBtn:!0,minViewMode:1,keyboardNavigation:!1,daysOfWeekDisabled:"0,1,2,3,4,5,6",daysOfWeekHighlighted:"0,1,2,3,4,5,6",calendarWeeks:!0,autoclose:!0,language:"he",datesDisabled:["02/06/2016","02/21/2016"]}).on("show",function(a){$(".datepicker tfoot th.today").hide(),0==$(".datepicker tfoot th.custom").length&&$(".datepicker tfoot").append('<tr><th colspan="4" class="custom expired">נזילה</th><th colspan="4" class="custom not-expired">לא תהיה נזילה</th></tr>'),$(".datepicker tfoot th").on("click",function(){var b,c=$(this),d=new Date;c.hasClass("not-expired")?(d.setMonth(d.getMonth()+200),b=(d.getDate()<10?"0"+d.getDate():d.getDate())+"-"+(d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1)+"-"+d.getFullYear()):c.hasClass("expired")&&(b=d.toDateString()),$(a.currentTarget).val(b).datepicker("setDate",b),$(".datepicker").remove()})})},1500)})}}}]),creditoDirectives.directive("onKeyup",function(){return function(a,b,c){var d=a.$eval(c.keys);b.bind("keydown",function(a){angular.forEach(d,function(b){return b==a.which?(a.preventDefault(),window.stop(),document.execCommand("Stop"),!1):void 0})})}}),creditoDirectives.directive("checkChanges",["$timeout",function(a){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(b){d.$dirty&&(a.borrowerModel.userDetails&&a.borrowerModel.userDetails[d.$name]&&(a.borrowerModel.userDetails[d.$name].isChanged=!0),a.borrowerModel.spouseDetails&&a.borrowerModel.spouseDetails[d.$name]&&(a.borrowerModel.spouseDetails[d.$name].isChanged=!0),a.borrowerModel.commonDetails&&a.borrowerModel.commonDetails[d.$name]&&(a.borrowerModel.commonDetails[d.$name].isChanged=!0),a.borrowerModel.loanDetails&&a.borrowerModel.loanDetails[d.$name]&&(a.borrowerModel.loanDetails[d.$name].isChanged=!0),a.borrowerModel.bankAccount&&a.borrowerModel.bankAccount[d.$name]&&(a.borrowerModel.bankAccount[d.$name].isChanged=!0))},!0)}}}]),creditoDirectives.directive("cloneModel",["$timeout",function(a){return{require:"ngModel",link:function(b,c,d,e){a(function(){b.borrowerModel.userDetails&&b.borrowerModel.spouseDetails&&b.borrowerModel.userDetails[e.$name]&&b.borrowerModel.spouseDetails[e.$name]&&(b.borrowerModel.spouseDetails[e.$name].value=b.borrowerModel.userDetails[e.$name].value,b.borrowerModel.spouseDetails[e.$name].isChanged=!0)},3e3),b.$watch(d.ngModel,function(a){e.$dirty&&b.borrowerModel.userDetails&&b.borrowerModel.spouseDetails&&b.borrowerModel.userDetails[e.$name]&&b.borrowerModel.spouseDetails[e.$name]&&(b.borrowerModel.spouseDetails[e.$name].value=b.borrowerModel.userDetails[e.$name].value,b.borrowerModel.spouseDetails[e.$name].isChanged=!0)},!0)}}}]),creditoDirectives.directive("numbersOnlyChildren",["CONFIG",function(a){return{require:"ngModel",link:function(b,c,d,e){b.$watch(d.ngModel,function(){e.$parsers.push(function(b){var c=b.replace(/[^0-9]/g,"");return b>parseInt(a.MAX_CHILDREN_NUMBER)?(c=a.MAX_CHILDREN_NUMBER,e.$setViewValue(a.MAX_CHILDREN_NUMBER),e.$render()):c!=b&&(e.$setViewValue(c),e.$render()),c})})}}}]),creditoDirectives.directive("loanLength",["CONFIG",function(a){return{require:"ngModel",link:function(b,c,d,e){b.$watch(d.ngModel,function(){e.$parsers.unshift(function(b){if(void 0==b)return"";var d=b;return b>parseInt(a.MAX_LOAN_NUMBER)?(d=a.MAX_LOAN_NUMBER,c.val(d)):b<parseInt(a.MIN_LOAN_NUMBER)&&(d=a.MIN_LOAN_NUMBER,c.val(d)),d})},!0)}}}]),creditoDirectives.directive("familyIncome",["CONFIG",function(a){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(){d.$parsers.unshift(function(a){if(void 0==a)return"";var c=a;return parseInt(a)<1&&(c="1",b.val(c)),c})},!0)}}}]),creditoDirectives.directive("uploadItem",[function(){return{restrict:"E",templateUrl:"templates/partials/upload-item.html",require:"^?UploadController",link:function(a,b){}}}]),creditoDirectives.directive("uploadItemSignatures",[function(){return{restrict:"E",templateUrl:"templates/partials/upload-item-signatures.html",require:"^?BorrowerReportAndDocumentsDigitalSignatureController",link:function(a,b){}}}]),creditoDirectives.directive("uploadItemSpouse",[function(){return{restrict:"E",templateUrl:"templates/partials/upload-item-spouse.html",require:"^?UploadSpouseController",link:function(a,b){}}}]),creditoDirectives.directive("backButton",["$window","$location","CONFIG",function(a,b,c){return{restrict:"E",template:'<a class="btn btn-icon btn-back btn-primary go-back-btn" ng-transclude></a>',transclude:!0,link:function(b,d){b.historyBack=function(){a.history.back()},b.goToPage=function(){a.location.href=c.SITE_URL}}}}]),creditoDirectives.directive("userInfoPanel",[function(){return{restrict:"E",scope:{name:"=",status:"=",progress:"=",firstName:"="},templateUrl:"templates/partials/user-info-panel.html",link:function(a,b){}}}]),creditoDirectives.directive("redLights",[function(){return{restrict:"EA",templateUrl:"templates/partials/redLightsIndicator.html",link:function(a,b,c){a.noteValue="";var d=$(b),e=d.find('input[type="text"]');a.$watch(function(){return e.val()},function(a,b){})}}}]),creditoDirectives.directive("userStatusModal",["$timeout",function(a){return{restrict:"E",transclude:!0,replace:!0,scope:{show:"=",status:"="},templateUrl:"templates/pages/modal/inform-user-status.html",link:function(b,c,d){b.$watch("show",function(){b.show&&a(function(){$(c).modal("show")},2e3)})}}}]),creditoDirectives.directive("calculationCharts",[function(){return{restrict:"A",link:function(a,b,c,d){a.chart={xAxisSeries:[],yAxisSeries:[]};var e=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(b).attr("id")},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},xAxis:{labels:{formatter:function(){return Highcharts.numberFormat(this.value,0,"",",")}},categories:[1,2,3,4,5,6,7,8,9,11,12,13,14,15,16,17]},yAxis:{title:{text:null},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{enabled:!1},series:[{showInLegend:!1,data:[1,2,3,4,5,6,7,8,9,11,12,13,14,15,16,17]}]});a.$watch("results.payments.graph",function(){a.chart.xAxisSeries=_.pluck(a.results.payments.graph,"loanSize"),a.chart.yAxisSeries=_.pluck(a.results.payments.graph,"interest"),a.chart.yAxisSeries.length>0&&(e.xAxis[0].update({categories:a.chart.xAxisSeries},!0),e.series[0].setData(a.chart.yAxisSeries))})}}}]),creditoDirectives.directive("indexLinkedChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(a,c,d,e){var f,g=[];a.chart={xAxisSeries:[],yAxisSeries:[]},a.$watch("statusSummary",function(){if(a.statusSummary){for(var d=0;d<a.statusSummary.indexLinkedChart.chartData.length;d++){var e={name:"",y:"",color:""};e.name=b("translate")("INDEX_LINKED."+a.statusSummary.indexLinkedChart.chartData[d].type),e.alias=b("translate")("INDEX_LINKED."+a.statusSummary.indexLinkedChart.chartData[d].type)+"<br/>"+a.statusSummary.indexLinkedChart.chartData[d].percent+"%",e.y=a.statusSummary.indexLinkedChart.chartData[d].amount,"Linked"==a.statusSummary.indexLinkedChart.chartData[d].type?e.color="#ff0000":"NonLinked"==a.statusSummary.indexLinkedChart.chartData[d].type?e.color="#538cd5":e.color="#47a447",g.push(e)}f=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(c).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},plotOptions:{pie:{size:160,showInLegend:!0,dataLabels:{enabled:!1}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{pointFormat:"{point.percentage:.1f}%",backgroundColor:null,borderColor:null,borderWidth:0,enabled:!0},series:[{colorByPoint:!0,data:g,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:1,distance:8,style:{whiteSpace:"nowrap"},formatter:function(){return this.point.alias},x:0,y:3,useHTML:!0}}]})}})}}}]),creditoDirectives.directive("ltvNonLiquidLoans",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(a,c,d,e){var f,g=[],h=[],i=[];a.chart={xAxisSeries:[],yAxisSeries:[]},a.$watch("statusSummary",function(){if(a.statusSummary){for(var d=0;d<a.statusSummary.nonLiquidLTVChart.chartData.length;d++){var e=null==a.statusSummary.liquidLTVChart.chartData[d].intervalBegin?"נמוך מ":a.statusSummary.liquidLTVChart.chartData[d].intervalBegin,j=null==a.statusSummary.liquidLTVChart.chartData[d].intervalEnd?"מעל ":a.statusSummary.liquidLTVChart.chartData[d].intervalEnd;g.push(e+" - "+j),h.push(a.statusSummary.nonLiquidLTVChart.chartData[d].inRangePercent),i.push(a.statusSummary.nonLiquidLTVChart.chartData[d].accumulativePercent)}f=new Highcharts.Chart({chart:{renderTo:c.attr("id"),spacingBottom:0},title:{text:""},tooltip:{enabled:!1,formatter:""},legend:{layout:"vertical",align:"top",verticalAlign:"top",borderWidth:0,x:20,y:10},xAxis:[{categories:g,crosshair:!0,labels:{y:20,x:0}}],yAxis:[{min:0,labels:{style:{color:"#ff0000"}},color:"#ff0000",title:{text:"",style:{color:"#ff0000"}},opposite:!0},{gridLineWidth:0,min:0,color:Highcharts.getOptions().colors[0],labels:{style:{color:Highcharts.getOptions().colors[0]}},title:{text:"",style:{color:Highcharts.getOptions().colors[0]}}}],plotOptions:{line:{marker:{enable:!1}},series:{dataLabels:{style:{"margin-top":"100px"},html:!0}}},series:[{name:b("translate")("LTV.IN_RANGE"),type:"column",yAxis:1,data:h,color:Highcharts.getOptions().colors[0],html:!0},{name:b("translate")("LTV.ACCUMULATIVE"),type:"spline",yAxis:0,data:i,color:"#ff0000",html:!0}]})}})}}}]),creditoDirectives.directive("ltvLiquidLoans",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(a,c,d,e){var f,g=[],h=[],i=[];a.chart={xAxisSeries:[],yAxisSeries:[]},a.$watch("statusSummary",function(){if(a.statusSummary){for(var d=0;d<a.statusSummary.liquidLTVChart.chartData.length;d++){var e=null==a.statusSummary.liquidLTVChart.chartData[d].intervalBegin?"נמוך מ":a.statusSummary.liquidLTVChart.chartData[d].intervalBegin,j=null==a.statusSummary.liquidLTVChart.chartData[d].intervalEnd?"מעל ":a.statusSummary.liquidLTVChart.chartData[d].intervalEnd;g.push(e+" - "+j),h.push(a.statusSummary.liquidLTVChart.chartData[d].inRangePercent),i.push(a.statusSummary.liquidLTVChart.chartData[d].accumulativePercent)}f=new Highcharts.Chart({chart:{renderTo:c.attr("id"),spacingBottom:0},title:{text:""},tooltip:{enabled:!1,formatter:""},legend:{layout:"vertical",align:"top",verticalAlign:"top",borderWidth:0,x:20,y:10},xAxis:[{categories:g,crosshair:!0,labels:{y:20,x:0}}],yAxis:[{min:0,labels:{style:{color:"#ff0000"}},color:"#ff0000",title:{text:"",style:{color:"#ff0000"}},opposite:!0},{gridLineWidth:0,min:0,labels:{style:{color:Highcharts.getOptions().colors[0]}},color:Highcharts.getOptions().colors[0],title:{text:"",style:{color:Highcharts.getOptions().colors[0]}}}],plotOptions:{series:{dataLabels:{style:{"margin-top":"100px"},html:!0}}},series:[{name:b("translate")("LTV.IN_RANGE"),type:"column",yAxis:1,data:h,color:Highcharts.getOptions().colors[0],html:!0},{name:b("translate")("LTV.ACCUMULATIVE"),type:"spline",yAxis:0,data:i,color:"#ff0000",html:!0}]})}})}}}]),creditoDirectives.directive("projectedPaymentsChart",["$timeout",function(a){return{restrict:"A",link:function(a,b,c,d){var e,f=[],g=[],h=[],i=[];a.chart={xAxisSeries:[],yAxisSeries:[]},a.$watch("statusSummary",function(){if(a.statusSummary){for(var c=0;c<a.statusSummary.paymentsChart.chartData.length;c+=3){var d=new Date(a.statusSummary.paymentsChart.chartData[c].date);date=(d.getDate()<10?"0"+d.getDate():d.getDate())+"-"+(d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1)+"-"+d.getFullYear(),f.push(date),g.push(a.statusSummary.paymentsChart.chartData[c].earlyPayments),h.push(a.statusSummary.paymentsChart.chartData[c].fundLeft),i.push(a.statusSummary.paymentsChart.chartData[c].defaults)}e=new Highcharts.Chart({chart:{renderTo:b.attr("id")},title:{text:""},tooltip:{enabled:!1,formatter:""},xAxis:[{categories:f,crosshair:!0,labels:{y:30,x:0}}],legend:{align:"right",x:-50,verticalAlign:"top",y:-10,itemDistance:20,itemHiddenStyle:{padding:"10px","text-anchor":"end"},floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},yAxis:[{min:0,labels:{style:{color:"#538cd5"}},color:"#538cd5",title:{text:"",style:{color:"#538cd5"}},opposite:!0},{min:0,labels:{style:{color:"#47a447"}},color:"#47a447",title:{text:'מיליוני ש"ח',style:{color:"#47a447"}}}],plotOptions:{series:{marker:{enable:!1,radius:0}}},series:[{name:"שווי התיק",type:"spline",yAxis:1,data:h,color:"#47a447"},{name:"חדלות פרעון",type:"spline",yAxis:0,data:g,color:"#538cd5"},{name:"פרעון מוקדם",type:"spline",yAxis:0,data:i,color:"#ff0000"}]})}})}}}]),creditoDirectives.directive("cashFlowChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(c,d,e,f){c.$watch("cashFlowModel",function(){a(function(){for(var a=[],e=[],f=[],g=0;g<c.cashFlowModel.values.length;g++){var h=new Date(c.cashFlowModel.values[g].date);date=(h.getDate()<10?"0"+h.getDate():h.getDate())+"-"+(h.getMonth()<9?"0"+(h.getMonth()+1):h.getMonth()+1)+"-"+h.getFullYear(),a.push(date),e.push(c.cashFlowModel.values[g].remainingFund),f.push(c.cashFlowModel.values[g].cashflowAmount)}var i;c.chart={xAxisSeries:[],yAxisSeries:[]},Highcharts.setOptions({lang:{thousandsSep:","}}),i=new Highcharts.Chart({chart:{renderTo:d.attr("id")},title:{text:""},tooltip:{enabled:!1,formatter:""},xAxis:[{categories:a,crosshair:!0,labels:{y:25,x:0}}],legend:{align:"right",x:-30,verticalAlign:"top",y:25,itemDistance:50,itemHiddenStyle:{padding:"10px","text-anchor":"end"},floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},yAxis:[{labels:{style:{color:"#538cd5"}},title:{text:"",style:{color:"#538cd5"}},opposite:!0},{labels:{style:{color:"green"}},title:{text:"",style:{color:"#538cd5"}}}],plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1,color:"red",format:"{point.y:.1f}"}}},series:[{name:b("translate")("CASH_FLOW.REMAINING_FUND"),type:"spline",yAxis:1,data:e,color:"green"},{name:b("translate")("CASH_FLOW.CASH_FLOW_AMOUNT"),type:"spline",yAxis:0,data:f,color:"#538cd5"}]})},500)})}}}]),creditoDirectives.directive("liquidityChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(c,d,e,f){var g;c.chart={xAxisSeries:[],yAxisSeries:[]},c.$watch("statisticsModel",function(){a(function(){for(var a=[],e=0;e<c.statisticsModel.liquidity.chartData.length;e++)a.push({name:b("translate")("INVESTOR_STATISTICS."+c.statisticsModel.liquidity.chartData[e].label),y:c.statisticsModel.liquidity.chartData[e].percent});g=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(d).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",y:-100,labelFormatter:function(){return"<span>"+this.name+"</span>"},useHTML:!0},plotOptions:{pie:{size:160,showInLegend:!0,dataLabels:{enabled:!0}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{pointFormat:"{point.percentage:.1f}%",backgroundColor:null,borderColor:null,borderWidth:0,enabled:!0},series:[{name:null,colorByPoint:!0,data:a,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:5,distance:15,style:{whiteSpace:"nowrap"},x:-2,y:0,useHTML:!0}}]})},500)})}}}]),creditoDirectives.directive("sumChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(c,d,e,f){var g;c.chart={xAxisSeries:[],yAxisSeries:[]},c.$watch("statisticsModel",function(){a(function(){for(var a=[],e=0;e<c.statisticsModel.sum.chartData.length;e++)a.push({name:b("translate")("INVESTOR_STATISTICS."+c.statisticsModel.sum.chartData[e].label),y:c.statisticsModel.sum.chartData[e].percent});Highcharts.setOptions({colors:["#4F81BD","#C0504D","#9BBB59","#5C0174"]}),g=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(d).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",y:-100,labelFormatter:function(){return"<span>"+this.name+"</span>"},useHTML:!0},plotOptions:{pie:{size:160,showInLegend:!0,dataLabels:{enabled:!0}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{pointFormat:"{point.percentage:.1f}%",backgroundColor:null,borderColor:null,borderWidth:0,enabled:!0},series:[{name:null,colorByPoint:!0,data:a,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:5,distance:15,style:{whiteSpace:"nowrap"},x:-2,y:0,useHTML:!0}}]})},500)})}}}]),creditoDirectives.directive("interestChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(c,d,e,f){var g;c.chart={xAxisSeries:[],yAxisSeries:[]},c.$watch("statisticsModel",function(){a(function(){for(var a=[],e=0;e<c.statisticsModel.interest.chartData.length;e++)a.push({name:b("translate")("INVESTOR_STATISTICS."+c.statisticsModel.interest.chartData[e].label),y:c.statisticsModel.interest.chartData[e].percent});g=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(d).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",y:-100,labelFormatter:function(){return"<span>"+this.name+"</span>"},useHTML:!0},plotOptions:{pie:{size:160,showInLegend:!0,dataLabels:{enabled:!0}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{pointFormat:"{point.percentage:.1f}%",backgroundColor:null,borderColor:null,borderWidth:0,enabled:!0},series:[{name:null,colorByPoint:!0,data:a,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:5,distance:15,style:{whiteSpace:"nowrap"},x:-2,y:0,useHTML:!0}}]})},500)})}}}]),creditoDirectives.directive("statusChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(c,d,e,f){var g;c.chart={xAxisSeries:[],yAxisSeries:[]},c.$watch("statisticsModel",function(){a(function(){for(var a=[],e=0;e<c.statisticsModel.status.chartData.length;e++)a.push({name:b("translate")("INVESTOR_STATISTICS."+c.statisticsModel.status.chartData[e].label)+" "+c.statisticsModel.status.chartData[e].percent+"%",y:c.statisticsModel.status.chartData[e].percent});g=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(d).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",y:-100,labelFormatter:function(){return"<span>"+this.name+"</span>"},useHTML:!0},plotOptions:{pie:{size:160,showInLegend:!0,dataLabels:{enabled:!0}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{pointFormat:"{point.percentage:.1f}%",backgroundColor:null,borderColor:null,borderWidth:0,enabled:!0},series:[{name:null,colorByPoint:!0,data:a,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:5,distance:15,style:{whiteSpace:"nowrap"},x:-2,y:0,useHTML:!0}}]})},500)})}}}]),creditoDirectives.directive("timeChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(a,c,d,e){var f;Highcharts.setOptions({colors:["#4F81BD","#C0504D","#9BBB59","#5C0174"]}),a.chart={xAxisSeries:[],yAxisSeries:[]},a.$watch("statisticsModel",function(){if(a.statisticsModel){for(var d=[],e=0;e<a.statisticsModel.time.chartData.length;e++)d.push({name:b("translate")("INVESTOR_STATISTICS."+a.statisticsModel.time.chartData[e].label),y:a.statisticsModel.time.chartData[e].value});f=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(c).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",y:-100,labelFormatter:function(){return"<span>"+this.name+"</span>"},useHTML:!0},plotOptions:{pie:{size:160,showInLegend:!0,dataLabels:{enabled:!0}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{pointFormat:"{point.percentage:.1f}%",backgroundColor:null,borderColor:null,borderWidth:0,enabled:!0},series:[{colorByPoint:!0,data:d,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:5,distance:15,style:{whiteSpace:"nowrap"},x:-2,y:0,useHTML:!0}}]})}})}}}]),creditoDirectives.directive("paymentsForcastChart",["$timeout","$filter",function(a,b){return{restrict:"A",link:function(a,c,d,e){var f,g=[],h=[];a.chart={xAxisSeries:[],yAxisSeries:[]},Highcharts.setOptions({lang:{thousandsSep:","}}),a.$watch("statusModel",function(){if(a.statusModel){for(var d=0;d<a.statusModel.paymentForecasts.length;d++){var e=new Date(a.statusModel.paymentForecasts[d].date);date=(e.getDate()<10?"0"+e.getDate():e.getDate())+"-"+(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+e.getFullYear(),g.push(date),h.push(a.statusModel.paymentForecasts[d].amount)}console.log(h),f=new Highcharts.Chart({chart:{renderTo:c.attr("id"),spacingBottom:0},title:{text:""},tooltip:{enabled:!1,formatter:""},legend:{enable:!1},xAxis:[{categories:g,crosshair:!0,labels:{y:20,x:0}}],yAxis:[{gridLineWidth:0,min:0,labels:{style:{color:Highcharts.getOptions().colors[0]}},color:Highcharts.getOptions().colors[0],title:{text:"",style:{color:Highcharts.getOptions().colors[0]}}}],plotOptions:{series:{dataLabels:{style:{"margin-top":"100px"},enable:!0,html:!0}}},series:[{name:b("translate")("INTEREST_PAYMENTS.PAYMENT_FORCAST"),type:"column",yAxis:0,data:h,color:Highcharts.getOptions().colors[0],html:!0,dataLabels:{enabled:!0,style:{whiteSpace:"nowrap"},useHTML:!0}}]})}})}}}]),creditoDirectives.directive("loanFundChart",["$filter",function(a){return{restrict:"A",link:function(b,c,d,e){var f,g=[];b.chart={xAxisSeries:[],yAxisSeries:[]},b.$watch("statusModel",function(){if(b.statusModel){for(var d=0;d<b.statusModel.loanFund.chartData.length;d++)g.push({name:a("translate")("BORROWER_LOAN_FUND."+b.statusModel.loanFund.chartData[d].label),y:b.statusModel.loanFund.chartData[d].percent});f=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:$(c).attr("id"),plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",y:-100,labelFormatter:function(){return"<span>"+this.name+"</span>"},useHTML:!0},plotOptions:{pie:{size:200,showInLegend:!0,dataLabels:{enabled:!0}}},title:{text:null},exporting:{enabled:!0},subtitle:{text:null},tooltip:{enabled:!1},series:[{colorByPoint:!0,data:g,dataLabels:{enabled:!0,connectorWidth:1,connectorPadding:5,distance:15,style:{whiteSpace:"nowrap"},formatter:function(){return this.point.y+"%"},x:-2,y:0,useHTML:!0}}]})}})}}}]),creditoDirectives.directive("datePickerEarlyPayment",[function(){return{restrict:"EA",link:function(a,b,c,d){a.$watch(b,function(){$(".datepickerEarlyPayment").datepicker({format:"dd-mm-yyyy",maxViewMode:0,startDate:new Date,autoclose:!0,language:"he"})})}}}]),creditoDirectives.directive("jSignatureDirective",function(){return{restrict:"E",template:'<div id="signature"><div id="jSignature"></div><div class=" glyphicon glyphicon-remove"  id="resetSignature" ng-click="reset()"></div><button class="btn btn-primary" id="saveSignature" ng-click="getData()">אישור</button></div>',require:"^?BorrowerReportAndDocumentsDigitalSignatureController",link:function(a,b){a.initialized=!1;var c={"background-color":"rgb(211, 211, 211)",color:"#002060"};a.initialize=function(){a.initialized||(b.find("#jSignature").jSignature(c),a.initialized=!0)},a.reset=function(){b.jSignature("reset")},a.$on("loadFile",function(){a.reset()}),a.getData=function(){var c=b.jSignature("getData");b.jSignature("getData","svg");a.saveSignature(c)},a.setData=function(a){a&&(datapair=a),b.jSignature("setData","data:"+datapair.join(","))},a.initialize(),a.$watch("sig",function(b){return b?void a.setData(b):void 0})}}}).controller("SignatureController",function(a){a.items=[{text:"learn angular",done:!0},{text:"build an angular app",done:!1}],a.testAction=function(b){a.items.push({}),a.hash="data:"+b[0]+","+b[1];var c=new Image;c.src="data:"+b[0]+","+b[1],console.log(b[0]),$(c).appendTo($("body"))};var b=["image/jsignature;base30"];b[1]="base30,2A0Z101100001110000000_4XZ6954655685877555655_3I10000000000000000Z1_4RZ487868658576656664_2B469754_3w10000Z1_4A001011000000000000_4NZ856566755597676675_4D65_q00_4F654_1E201_4B76_4KZ10_5K00000000000Z100000001_4PZ79678786555467565554_5L34334_4OZ21221_6N0001001000000000000_4PZ6958888755776556655_6P43332_4OZ32323_8CZ322121010000000Y1132342111012001000100Z11234_1K24444554556657554332Z134555445656656554432Y1_aF0Z1000000100000000000Y12231322222212212222322221000010000Z101000000_i559657657575558555564Z536455335435Y336443434335Z68789556a6984656655_cOZ42120000Y212323422110000Z11232_1N25545556554442Z43554555754433_dK00000100000000000Z11112Y4543433Z3545_4GZ565557897a555586764454Y22121232210_ew0000000001101110111_g6767677675687645444_eR0100000000000001355_i8895559a78855665200_gHZ345522200Y1233355211_3uZ3100Y334555322210Z344_gJ0001011001000000001001_a6674666565765655564554_iM223223224211123122213332323242222222222Z658669654374555_3yZ53546644734443553334Y3643453564337444435000000001201000_jD323333_3H545632_ku445533_3J244643_kT78aa8_3I36565",
a.customSignature=b});var constants=angular.module("constants",[]);constants.constant("CONFIG",{API_URL:"https://credito.igniteoutsourcing.com/allinone/api",SITE_URL:"https://credito.igniteoutsourcing.com/allinone",MAX_CHILDREN_NUMBER:"20",MAX_LOAN_NUMBER:"84",MAX_LOAN_SUM:"2000000",MIN_LOAN_SUM:"10000",MAX_YEAR_LIMIT:"50",RESET_STATUS:-1,APPROVE_MAIL_STATUS:0,REGISTER_STATUS:1,PERSONAL_STATUS:2,SALARY_STATUS:3,UPLOAD_STATUS:4,VERIFICATION_STATUS:5,LOAN_STATUS:6,CHECK_VERIFICATION_ID:0,MAX_COLLATERALS_ROW:5,SCROLL_TO_UP_DURATION:300,REFRESH_TOKEN_INTERVAL:30});